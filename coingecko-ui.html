<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS - Multi-Blockchain Trading Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/chart.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <!-- Wallet Connection Libraries -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .green-text { color: #16a34a; }
        .red-text { color: #dc2626; }
        .sparkline-container { width: 100px; height: 40px; }
        
        /* CoinGecko-like styling */
        .coin-row:hover { background-color: #f8fafc; }
        .price-up { color: #16a34a; background-color: #dcfce7; }
        .price-down { color: #dc2626; background-color: #fee2e2; }
        .market-cap { color: #6b7280; font-size: 0.875rem; }
        
        /* Tabs */
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            background-color: #f1f5f9;
        }
        .tab-inactive {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        
        /* Live Updates & Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeInScale {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }
        
        @keyframes priceFlash {
            0% { background-color: transparent; }
            50% { background-color: #fef3c7; }
            100% { background-color: transparent; }
        }
        
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        
        @keyframes blink {
            0%, 50% { border-color: transparent; }
            51%, 100% { border-color: #3b82f6; }
        }
        
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-slide-in-right { animation: slideInRight 0.6s ease-out; }
        .animate-slide-in-up { animation: slideInUp 0.5s ease-out; }
        .animate-fade-in-scale { animation: fadeInScale 0.4s ease-out; }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
        .animate-price-flash { animation: priceFlash 0.8s ease-out; }
        .animate-typing { 
            animation: typing 2s steps(40, end), blink 0.5s step-end infinite alternate;
            border-right: 2px solid #3b82f6;
            white-space: nowrap;
            overflow: hidden;
        }
        
        /* Real-time indicators */
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #10b981;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            margin-right: 8px;
        }
        
        .updating {
            position: relative;
        }
        
        .updating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            animation: loading-bar 2s linear infinite;
        }
        
        @keyframes loading-bar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Loading skeletons */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Token info modal */
        .modal-overlay {
            backdrop-filter: blur(8px);
            animation: fadeInScale 0.3s ease-out;
        }
        
        .modal-content {
            animation: slideInUp 0.4s ease-out;
        }
        
        /* Price change effects */
        .price-increase {
            animation: priceFlash 0.6s ease-out;
            color: #16a34a;
        }
        
        .price-decrease {
            animation: priceFlash 0.6s ease-out;
            color: #dc2626;
        }
        
        /* Data streaming effects */
        .streaming-data {
            position: relative;
            overflow: hidden;
        }
        
        .streaming-data::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.2), transparent);
            animation: stream 3s linear infinite;
        }
        
        @keyframes stream {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Floating elements */
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* Dark mode styles */
        .dark {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        .dark .bg-white {
            background-color: #1e293b !important;
        }
        
        .dark .bg-gray-50 {
            background-color: #334155 !important;
        }
        
        .dark .bg-gray-100 {
            background-color: #475569 !important;
        }
        
        .dark .text-gray-900 {
            color: #e2e8f0 !important;
        }
        
        .dark .text-gray-700 {
            color: #cbd5e1 !important;
        }
        
        .dark .text-gray-600 {
            color: #94a3b8 !important;
        }
        
        .dark .border-gray-100 {
            border-color: #475569 !important;
        }
        
        .dark .border-gray-200 {
            border-color: #64748b !important;
        }
        
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* Chart animations */
        .chart-container {
            position: relative;
            overflow: hidden;
        }
        
        .chart-loading {
            background: linear-gradient(45deg, #f3f4f6 25%, transparent 25%), 
                        linear-gradient(-45deg, #f3f4f6 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f3f4f6 75%), 
                        linear-gradient(-45deg, transparent 75%, #f3f4f6 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            animation: chart-loading 1s linear infinite;
        }
        
        @keyframes chart-loading {
            0% { background-position: 0 0, 0 10px, 10px -10px, -10px 0px; }
            100% { background-position: 20px 20px, 20px 30px, 30px 10px, 10px 20px; }
        }
        
        /* Responsive mobile animations */
        @media (max-width: 640px) {
            .animate-slide-in-right {
                animation: slideInUp 0.6s ease-out;
            }
        }
        
        /* Success/Error animations */
        @keyframes success-pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        @keyframes error-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        .success-animation { animation: success-pulse 0.6s; }
        .error-animation { animation: error-shake 0.6s; }
        
        /* Dark Mode Styles */
        .dark {
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        
        .dark .bg-white {
            background-color: #2d2d2d !important;
        }
        
        .dark .bg-gray-50 {
            background-color: #1a1a1a !important;
        }
        
        .dark .bg-gray-100 {
            background-color: #2d2d2d !important;
        }
        
        .dark .bg-slate-50 {
            background-color: #2d2d2d !important;
        }
        
        .dark .text-gray-900 {
            color: #e5e5e5 !important;
        }
        
        .dark .text-gray-700 {
            color: #a1a1aa !important;
        }
        
        .dark .text-gray-600 {
            color: #9ca3af !important;
        }
        
        .dark .text-gray-500 {
            color: #6b7280 !important;
        }
        
        .dark .border-gray-100 {
            border-color: #374151 !important;
        }
        
        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }
        
        .dark .border-gray-300 {
            border-color: #6b7280 !important;
        }
        
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1) !important;
        }
        
        .dark .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2) !important;
        }
        
        .dark input {
            background-color: #374151 !important;
            border-color: #6b7280 !important;
            color: #e5e5e5 !important;
        }
        
        .dark select {
            background-color: #374151 !important;
            border-color: #6b7280 !important;
            color: #e5e5e5 !important;
        }
        
        .dark .hover\\:bg-gray-50:hover {
            background-color: #374151 !important;
        }
        
        .dark .hover\\:bg-gray-100:hover {
            background-color: #4b5563 !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-12">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2">
                        <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-purple-600 rounded-md flex items-center justify-center">
                            <span class="text-white font-bold text-xs">N</span>
                        </div>
                        <h1 class="text-lg font-bold text-gray-900">NEXUS</h1>
                    </div>
                    
                    <nav class="flex space-x-4">
                        <button onclick="switchTab('overview')" class="tab-button tab-active px-2 py-1 text-xs font-medium">
                            Markets
                        </button>
                        <button onclick="switchTab('wallet')" class="tab-button tab-inactive px-2 py-1 text-xs font-medium">
                            Wallet
                        </button>
                        <button onclick="switchTab('portfolio')" class="tab-button tab-inactive px-2 py-1 text-xs font-medium">
                            Portfolio
                        </button>
                        <button onclick="switchTab('trading')" class="tab-button tab-inactive px-2 py-1 text-xs font-medium">
                            Trading
                        </button>
                        <button onclick="switchTab('credits')" class="tab-button tab-inactive px-2 py-1 text-xs font-medium">
                            Credits
                        </button>
                        <button onclick="switchTab('features')" class="tab-button tab-inactive px-2 py-1 text-xs font-medium">
                            Features
                        </button>
                        <button onclick="switchTab('developers')" class="tab-button tab-inactive px-2 py-1 text-xs font-medium">
                            Developers
                        </button>
                    </nav>
                </div>
                
                <div class="flex items-center space-x-3">
                    <div class="hidden lg:flex items-center text-xs text-gray-600">
                        <div class="live-indicator"></div>
                        <span class="font-medium">Live</span>
                    </div>
                    <div class="hidden lg:block text-xs text-gray-600 streaming-data">
                        <span class="font-medium">MC:</span>
                        <span id="total-market-cap" class="text-gray-900 font-bold ml-1">$1.72T</span>
                        <span id="market-change" class="ml-1 price-up px-1 py-0.5 rounded text-xs">+2.45%</span>
                    </div>
                    <div class="hidden md:block text-xs text-gray-600">
                        <span class="font-medium">Vol:</span>
                        <span id="total-volume-header" class="text-gray-900 font-bold ml-1">$89.1B</span>
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <div class="flex items-center space-x-2">
                        <button id="dark-mode-toggle" onclick="toggleDarkMode()" 
                            class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors duration-200 dark:hover:bg-gray-800" 
                            title="Toggle dark mode">
                            <span id="dark-mode-icon" class="text-lg">🌙</span>
                        </button>
                    </div>
                    
                    <!-- Credits Display -->
                    <div id="credits-display" class="hidden items-center px-2 py-1 bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg border border-emerald-200">
                        <span class="text-emerald-700 font-bold text-xs">
                            💎 <span id="user-credits-header">100</span>
                        </span>
                    </div>
                    
                    <!-- Wallet Connect -->
                    <div class="flex items-center space-x-2">
                        <button onclick="showWalletConnectionModal()" 
                            class="group relative flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-xs font-semibold rounded-md shadow-md hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-purple-500/50 transform hover:scale-105 transition-all duration-200">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <span id="wallet-connect-text">Connect Wallet</span>
                        </button>
                        
                        <!-- Theme Toggle -->
                        <button onclick="toggleTheme()" id="theme-toggle" 
                            class="p-1.5 rounded-md bg-gray-100 hover:bg-gray-200 transition-colors" title="Toggle theme">
                            <svg id="sun-icon" class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                            </svg>
                            <svg id="moon-icon" class="w-4 h-4 text-gray-700 hidden" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                            </svg>
                        </button>
                        
                        <!-- Swap to NUSD Button -->
                        <button onclick="showSwapModal()" 
                            class="group relative flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-600 to-violet-600 text-white text-xs font-bold rounded-md shadow-md hover:from-purple-700 hover:to-violet-700 focus:outline-none focus:ring-2 focus:ring-purple-500/50 transform hover:scale-105 transition-all duration-200">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                            <span>Swap to NUSD</span>
                        </button>
                        
                        <!-- Login Button -->
                        <button onclick="showLoginModal()" 
                            class="group relative flex items-center px-3 py-1.5 bg-gradient-to-r from-emerald-600 to-green-600 text-white text-xs font-bold rounded-md shadow-md hover:from-emerald-700 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 transform hover:scale-105 transition-all duration-200 animate-glow">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span id="login-text">Login</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- NUSD Swap Modal -->
    <div id="swap-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 animate-fade-in-scale">
            <div class="p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-violet-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">Swap to NUSD</h2>
                    <p class="text-gray-600 mt-2">Convert your crypto to NEXUS USD (1 NUSD = $1.00)</p>
                </div>

                <div class="space-y-4">
                    <!-- Token Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">From Token</label>
                        <select id="swap-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="usdt">Tether (USDT)</option>
                            <option value="doge">Dogecoin (DOGE)</option>
                            <option value="ton">TON</option>
                        </select>
                    </div>
                    
                    <!-- Amount Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                        <input type="number" id="swap-amount" step="0.00000001" placeholder="0.00000000" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <div class="text-xs text-gray-500 mt-1">You will receive: <span id="nusd-amount" class="font-semibold text-purple-600">0 NUSD</span></div>
                    </div>
                    
                    <!-- Destination Address Display -->
                    <div class="bg-gray-50 rounded-lg p-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Send to Address:</label>
                        <div id="destination-address" class="text-xs font-mono text-gray-600 break-all">Select token to see address</div>
                    </div>
                </div>

                <div class="flex space-x-3 mt-6">
                    <button onclick="performSwap()" 
                        class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-violet-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-violet-700 focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all duration-200">
                        Swap Now
                    </button>
                    <button onclick="closeSwapModal()" 
                        class="flex-1 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500/50 transition-all duration-200">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login/Credit Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 animate-fade-in-scale">
            <div class="p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">Welcome to NEXUS</h2>
                    <p class="text-gray-600 mt-2">Sign in to access premium trading features</p>
                </div>

                <div id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email or Username</label>
                        <input type="text" id="login-email" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                            placeholder="Enter your email or username">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="login-password" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                            placeholder="Enter your password">
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                            <span class="ml-2 text-sm text-gray-600">Remember me</span>
                        </label>
                        <a href="#" class="text-sm text-emerald-600 hover:text-emerald-500">Forgot password?</a>
                    </div>
                </div>

                <!-- User Profile (hidden initially) -->
                <div id="user-profile" class="hidden">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span id="user-avatar" class="text-white font-bold text-lg">U</span>
                        </div>
                        <h3 id="user-name" class="text-lg font-semibold text-gray-900">User Name</h3>
                        <p class="text-sm text-gray-600">Premium Member</p>
                    </div>

                    <!-- Credits Display -->
                    <div class="bg-gradient-to-r from-emerald-50 to-blue-50 rounded-xl p-4 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">NEXUS Credits</p>
                                <p id="user-credits" class="text-2xl font-bold text-emerald-600">100 🪙</p>
                            </div>
                            <button onclick="showCreditStore()" 
                                class="px-4 py-2 bg-gradient-to-r from-emerald-600 to-green-600 text-white text-sm font-semibold rounded-lg hover:from-emerald-700 hover:to-green-700 transition-all duration-200">
                                Buy More
                            </button>
                        </div>
                        <div class="mt-3 text-xs text-gray-500">
                            💎 Premium features unlocked • 🚀 Advanced trading tools
                        </div>
                    </div>

                    <!-- Credit Store (hidden initially) -->
                    <div id="credit-store" class="hidden">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Buy NEXUS Credits</h4>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button onclick="buyCredits(50, 4.99)" class="p-3 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-gray-900">50 🪙</div>
                                    <div class="text-sm text-gray-600">$4.99</div>
                                </div>
                            </button>
                            <button onclick="buyCredits(120, 9.99)" class="p-3 border-2 border-emerald-500 bg-emerald-50 rounded-lg hover:bg-emerald-100 transition-all duration-200">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-emerald-600">120 🪙</div>
                                    <div class="text-sm text-emerald-600">$9.99</div>
                                    <div class="text-xs text-emerald-500 font-medium">+20% Bonus</div>
                                </div>
                            </button>
                            <button onclick="buyCredits(250, 19.99)" class="p-3 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-gray-900">250 🪙</div>
                                    <div class="text-sm text-gray-600">$19.99</div>
                                    <div class="text-xs text-green-500 font-medium">+25% Bonus</div>
                                </div>
                            </button>
                            <button onclick="buyCredits(550, 39.99)" class="p-3 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-gray-900">550 🪙</div>
                                    <div class="text-sm text-gray-600">$39.99</div>
                                    <div class="text-xs text-green-500 font-medium">+30% Bonus</div>
                                </div>
                            </button>
                        </div>
                        <div class="text-xs text-gray-500 text-center mb-4">
                            💳 Secure payment via Stripe • 🔒 256-bit encryption
                        </div>
                    </div>

                    <!-- Premium Features -->
                    <div class="space-y-2 mb-6">
                        <h4 class="text-sm font-semibold text-gray-900">Premium Features (10 credits each)</h4>
                        <div class="text-xs text-gray-600 space-y-1">
                            <div>📊 Advanced Portfolio Analytics</div>
                            <div>🔔 Custom Price Alerts</div>
                            <div>🤖 AI Trading Recommendations</div>
                            <div>📈 Professional Charts & Indicators</div>
                            <div>⚡ Priority API Access</div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-3 mt-6">
                    <button id="login-btn" onclick="performLogin()" 
                        class="flex-1 py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-semibold rounded-lg hover:from-emerald-700 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 transition-all duration-200">
                        Sign In
                    </button>
                    <button onclick="closeLoginModal()" 
                        class="flex-1 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500/50 transition-all duration-200">
                        Close
                    </button>
                </div>

                <div class="text-center mt-4">
                    <p class="text-sm text-gray-600">
                        Don't have an account? 
                        <a href="#" class="text-emerald-600 hover:text-emerald-500 font-semibold">Sign up free</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <!-- Markets Overview Tab -->
        <div id="overview-tab" class="tab-content">
            <!-- Market Stats Bar -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg p-4 shadow-sm border card-hover updating animate-slide-in-up">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-gray-600 flex items-center">
                            <span class="mr-2">🪙</span>
                            Active Cryptocurrencies
                        </div>
                        <div class="text-xs text-green-500 animate-pulse">▲ Live</div>
                    </div>
                    <div id="active-cryptos" class="text-2xl font-bold text-gray-900 streaming-data">13,456</div>
                    <div class="text-xs text-gray-500 mt-1">
                        <span id="crypto-change" class="text-green-500">+127 today</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm border card-hover updating animate-slide-in-up" style="animation-delay: 0.1s;">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-gray-600 flex items-center">
                            <span class="mr-2">📊</span>
                            Total Volume (24h)
                        </div>
                        <div class="text-xs text-blue-500 animate-pulse">▲ Live</div>
                    </div>
                    <div id="total-volume" class="text-2xl font-bold text-gray-900 streaming-data">$89.1B</div>
                    <div class="text-xs text-gray-500 mt-1">
                        <span id="volume-change" class="text-green-500">+5.2% from yesterday</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm border card-hover updating animate-slide-in-up" style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-gray-600 flex items-center">
                            <span class="mr-2">₿</span>
                            Bitcoin Dominance
                        </div>
                        <div class="text-xs text-orange-500 animate-pulse">▲ Live</div>
                    </div>
                    <div id="btc-dominance" class="text-2xl font-bold text-gray-900 streaming-data">49.2%</div>
                    <div class="text-xs text-gray-500 mt-1">
                        <span id="btc-dominance-change" class="text-red-500">-0.3% this week</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm border card-hover updating animate-slide-in-up" style="animation-delay: 0.3s;">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-gray-600 flex items-center">
                            <span class="mr-2">📈</span>
                            Market Cap Change
                        </div>
                        <div class="text-xs text-green-500 animate-pulse">▲ Live</div>
                    </div>
                    <div id="market-cap-change" class="text-2xl font-bold green-text streaming-data">+2.45%</div>
                    <div class="text-xs text-gray-500 mt-1">
                        <span class="text-green-500">Bullish momentum</span>
                    </div>
                </div>
            </div>

            <!-- Trending Section -->
            <div class="mb-6 animate-slide-in-up" style="animation-delay: 0.4s;">
                <div class="bg-white rounded-lg shadow-sm border p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-base font-semibold text-gray-900 flex items-center">
                            🔥 <span class="ml-2">Trending</span>
                        </h3>
                        <div class="text-xs text-gray-500 flex items-center">
                            <div class="live-indicator"></div>
                            Live
                        </div>
                    </div>
                    <div id="trending-coins" class="grid grid-cols-3 gap-2">
                        <!-- Trending coins will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Main Table -->
            <div class="bg-white rounded-lg shadow-sm border overflow-hidden animate-slide-in-up" style="animation-delay: 0.5s;">
                <div class="px-6 py-4 border-b updating">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <span class="mr-2">💰</span>
                            Cryptocurrency Prices by Market Cap
                        </h2>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500 flex items-center">
                                <div class="live-indicator"></div>
                                <span id="data-freshness">Updated 5s ago</span>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="refreshData()" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors animate-glow">
                                    🔄 Refresh
                                </button>
                                <button onclick="toggleAutoRefresh()" class="px-3 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors">
                                    <span id="auto-refresh-text">⚡ Auto: ON</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Coin</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                <th class="px-2 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">1h %</th>
                                <th class="px-2 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">24h %</th>
                                <th class="px-2 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">7d %</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Market Cap</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Volume(24h)</th>
                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Last 7 Days</th>
                            </tr>
                        </thead>
                        <tbody id="coins-table" class="bg-white divide-y divide-gray-200">
                            <!-- Loading rows -->
                            <tr class="animate-pulse">
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <div class="h-3 bg-gray-200 rounded w-4"></div>
                                </td>
                                <td class="px-4 py-2 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="h-6 w-6 bg-gray-200 rounded-full mr-2"></div>
                                        <div>
                                            <div class="h-3 bg-gray-200 rounded w-16 mb-1"></div>
                                            <div class="h-2 bg-gray-200 rounded w-8"></div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap text-right">
                                    <div class="h-3 bg-gray-200 rounded w-16 ml-auto"></div>
                                </td>
                                <td class="px-2 py-2 whitespace-nowrap text-right">
                                    <div class="h-3 bg-gray-200 rounded w-10 ml-auto"></div>
                                </td>
                                <td class="px-2 py-2 whitespace-nowrap text-right">
                                    <div class="h-3 bg-gray-200 rounded w-10 ml-auto"></div>
                                </td>
                                <td class="px-2 py-2 whitespace-nowrap text-right">
                                    <div class="h-3 bg-gray-200 rounded w-10 ml-auto"></div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap text-right">
                                    <div class="h-3 bg-gray-200 rounded w-16 ml-auto"></div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap text-right">
                                    <div class="h-3 bg-gray-200 rounded w-16 ml-auto"></div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap text-center">
                                    <div class="h-6 bg-gray-200 rounded w-16 mx-auto"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Enhanced Wallet Tab -->
        <div id="wallet-tab" class="tab-content hidden">
            <!-- Ultra-Compact Wallet Overview Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg p-3 text-white">
                    <div class="flex items-center justify-between mb-1">
                        <h3 class="text-xs font-medium opacity-80">Balance</h3>
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-md flex items-center justify-center">
                            <span class="text-xs">💰</span>
                        </div>
                    </div>
                    <div class="text-lg font-bold" id="total-wallet-balance">$0.00</div>
                </div>
                
                <div class="bg-gradient-to-br from-emerald-500 to-green-600 rounded-lg p-3 text-white">
                    <div class="flex items-center justify-between mb-1">
                        <h3 class="text-xs font-medium opacity-80">Wallets</h3>
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-md flex items-center justify-center">
                            <span class="text-xs">🔐</span>
                        </div>
                    </div>
                    <div class="text-lg font-bold" id="active-wallets-count">0</div>
                </div>
                
                <div class="bg-gradient-to-br from-purple-500 to-violet-600 rounded-lg p-3 text-white">
                    <div class="flex items-center justify-between mb-1">
                        <h3 class="text-xs font-medium opacity-80">Change</h3>
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-md flex items-center justify-center">
                            <span class="text-xs">📈</span>
                        </div>
                    </div>
                    <div class="text-lg font-bold" id="wallet-24h-change">+0.00%</div>
                </div>
                
                <div class="bg-gradient-to-br from-orange-500 to-red-600 rounded-lg p-3 text-white">
                    <div class="flex items-center justify-between mb-1">
                        <h3 class="text-xs font-medium opacity-80">Transactions</h3>
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-md flex items-center justify-center">
                            <span class="text-xs">⚡</span>
                        </div>
                    </div>
                    <div class="text-lg font-bold" id="total-transactions">0</div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- Enhanced Wallet Actions -->
                <div class="lg:col-span-2 space-y-3">
                    <!-- Modern Wallet Management -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h3 class="text-base font-semibold text-gray-900">Wallet Management</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse" title="Secure Connection"></div>
                                    <span class="text-xs text-emerald-600 font-medium">Encrypted</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <!-- Compact Quick Action Cards -->
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <button onclick="showWalletAction('generate')" 
                                    class="group relative flex flex-col items-center justify-center p-3 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 hover:border-blue-300 rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-200">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                    </div>
                                    <div class="text-xs font-semibold text-gray-900 text-center">Generate</div>
                                </button>
                                
                                <button onclick="showWalletAction('import')" 
                                    class="group relative flex flex-col items-center justify-center p-3 bg-gradient-to-br from-emerald-50 to-green-50 border-2 border-emerald-200 hover:border-emerald-300 rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <div class="w-10 h-10 bg-gradient-to-r from-emerald-600 to-green-600 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-200">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                        </svg>
                                    </div>
                                    <div class="text-xs font-semibold text-gray-900 text-center">Import</div>
                                </button>
                                
                                <button onclick="showWalletAction('connect')" 
                                    class="group relative flex flex-col items-center justify-center p-3 bg-gradient-to-br from-purple-50 to-violet-50 border-2 border-purple-200 hover:border-purple-300 rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-violet-600 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-200">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                        </svg>
                                    </div>
                                    <div class="text-xs font-semibold text-gray-900 text-center">Connect</div>
                                </button>
                            </div>
                            
                            <!-- Dynamic Action Content -->
                            <div id="wallet-action-content" class="space-y-2">
                                <div class="text-center py-4 text-gray-500">
                                    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                        </svg>
                                    </div>
                                    <h4 class="text-sm font-semibold text-gray-900 mb-1">Wallet Management</h4>
                                    <p class="text-xs text-gray-600">Choose an action above</p>
                                </div>
                            </div>
                    </div>

                    <!-- Enhanced Send/Receive Panel -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-base font-semibold text-gray-900">Send & Receive</h3>
                        </div>
                        <div class="p-4">
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="showSendModal()" 
                                    class="group relative flex flex-col items-center justify-center p-3 bg-gradient-to-br from-red-50 to-rose-50 border-2 border-red-200 hover:border-red-300 rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <div class="w-8 h-8 bg-gradient-to-r from-red-600 to-rose-600 rounded-lg flex items-center justify-center mb-1 group-hover:scale-110 transition-transform duration-200">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                        </svg>
                                    </div>
                                    <div class="text-xs font-semibold text-gray-900">Send</div>
                                </button>
                                
                                <button onclick="showReceiveModal('ethereum')" 
                                    class="group relative flex flex-col items-center justify-center p-3 bg-gradient-to-br from-emerald-50 to-green-50 border-2 border-emerald-200 hover:border-emerald-300 rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <div class="w-8 h-8 bg-gradient-to-r from-emerald-600 to-green-600 rounded-lg flex items-center justify-center mb-1 group-hover:scale-110 transition-transform duration-200">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
                                        </svg>
                                    </div>
                                    <div class="text-xs font-semibold text-gray-900">Receive</div>
                                </button>

                                <button onclick="showContactSendModal()" 
                                    class="group relative flex flex-col items-center justify-center p-3 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 hover:border-blue-300 rounded-lg transition-all duration-200 hover:shadow-lg">
                                    <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center mb-1 group-hover:scale-110 transition-transform duration-200">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-xs font-semibold text-gray-900">Contacts</div>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Private Key Import -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-base font-semibold text-gray-900">Import Private Key</h3>
                        </div>
                        <div class="p-4">
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Private Key</label>
                                <input type="password" id="private-key-input" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Enter private key (hex format)...">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Blockchain</label>
                                <select id="blockchain-select" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="ETHEREUM">Ethereum</option>
                                    <option value="BITCOIN">Bitcoin</option>
                                    <option value="TON">TON</option>
                                    <option value="DOGECOIN">Dogecoin</option>
                                </select>
                            </div>
                            
                            <button onclick="importFromPrivateKey()" 
                                class="group relative flex items-center justify-center w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-violet-600 text-white font-semibold rounded-lg shadow-lg hover:from-purple-700 hover:to-violet-700 focus:outline-none focus:ring-4 focus:ring-purple-500/50 transform hover:scale-[1.02] transition-all duration-200">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 12H9v4a6 6 0 01-6-6V9a3 3 0 013-3h3.764a6 6 0 015.236 3z"></path>
                                </svg>
                                Import from Private Key
                                <span class="absolute inset-0 rounded-lg bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-200"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Address Lookup -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Address Lookup</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Address/Public Key</label>
                                <input type="text" id="address-input" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Enter address or public key...">
                            </div>
                            
                            <button onclick="lookupAddress()" 
                                class="group relative flex items-center justify-center w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-blue-600 text-white font-semibold rounded-lg shadow-lg hover:from-indigo-700 hover:to-blue-700 focus:outline-none focus:ring-4 focus:ring-indigo-500/50 transform hover:scale-[1.02] transition-all duration-200">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                Lookup Transactions
                                <span class="absolute inset-0 rounded-lg bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-200"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Wallet Display -->
                <div class="lg:col-span-1 space-y-4">
                    <!-- Enhanced Addresses Display -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h3 class="text-base font-semibold text-gray-900">Your Wallets</h3>
                                <button onclick="refreshWallets()" class="p-2 hover:bg-white rounded-lg transition-colors" title="Refresh">
                                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            <div id="addresses-display" class="space-y-2">
                                <div class="text-center text-gray-500 py-4">
                                    <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-sm font-semibold text-gray-900 mb-1">No Wallets Connected</div>
                                    <div class="text-xs text-gray-600 mb-2">Generate or import wallet</div>
                                    <button onclick="showWalletAction('generate')" class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-xs">
                                        Create Wallet
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Balances -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h3 class="text-base font-semibold text-gray-900">Portfolio Balance</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-emerald-600 font-medium">Live</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <div id="balances-display" class="space-y-2">
                                <div class="text-center text-gray-500 py-4">
                                    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                        </svg>
                                    </div>
                                    <div class="text-sm font-medium text-gray-900 mb-1">No Balances</div>
                                    <div class="text-xs text-gray-600">Connect wallet to view</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Transaction History -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h3 class="text-base font-semibold text-gray-900">Transaction History</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="exportTransactions()" class="text-xs text-blue-600 hover:text-blue-700 font-medium">Export</button>
                                    <button onclick="refreshTransactions()" class="p-1 hover:bg-white rounded transition-colors" title="Refresh">
                                        <svg class="w-3 h-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <div id="transactions-display" class="space-y-2">
                                <div class="text-center text-gray-500 py-4">
                                    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                        </svg>
                                    </div>
                                    <div class="text-sm font-medium text-gray-900 mb-1">No Transactions</div>
                                    <div class="text-xs text-gray-600">History will appear here</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Import Wallet Modal -->
            <div id="import-wallet-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
                <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 animate-fade-in-scale">
                    <div class="p-8">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900">Import Wallet</h2>
                            <p class="text-gray-600 mt-2">Enter your 12 or 24-word recovery phrase</p>
                        </div>

                        <div class="space-y-6">
                            <!-- Mnemonic Word Grid -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Recovery Phrase</label>
                                <div class="grid grid-cols-3 md:grid-cols-4 gap-3" id="mnemonic-grid">
                                    <!-- Mnemonic input boxes will be generated here -->
                                </div>
                                <div class="mt-3 text-center">
                                    <button onclick="toggleMnemonicLength()" class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                                        <span id="mnemonic-toggle-text">Switch to 24 words</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Advanced Options -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-semibold text-gray-900">Advanced Options</h4>
                                    <button onclick="toggleAdvancedOptions()" class="text-sm text-blue-600 hover:text-blue-700">
                                        <span id="advanced-toggle">Show</span>
                                    </button>
                                </div>
                                <div id="advanced-options" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-600 mb-1">Derivation Path</label>
                                        <input type="text" id="derivation-path" value="m/44'/60'/0'/0" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-600 mb-1">Password (Optional)</label>
                                        <input type="password" id="seed-password" placeholder="BIP39 passphrase" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-3 mt-8">
                            <button onclick="importWalletFromMnemonic()" 
                                class="flex-1 py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-700 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 transition-all duration-200">
                                Import Wallet
                            </button>
                            <button onclick="closeImportModal()" 
                                class="flex-1 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500/50 transition-all duration-200">
                                Cancel
                            </button>
                        </div>

                        <div class="text-center mt-4">
                            <p class="text-xs text-gray-500">
                                🔒 Your recovery phrase is encrypted and stored locally. We never see your private keys.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio Tab -->
        <div id="portfolio-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Portfolio Performance</h3>
                        <div id="portfolio-chart" style="height: 400px;"></div>
                    </div>
                </div>
                <div>
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Asset Allocation</h3>
                        <div id="allocation-display" class="space-y-3">
                            <div class="text-center text-gray-500 py-8">
                                <div class="text-sm">No portfolio data</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Tab -->
        <div id="trading-tab" class="tab-content hidden">
            <!-- Fixed Trading Interface -->
            <div class="grid grid-cols-1 xl:grid-cols-4 gap-4">
                <!-- Trading Panel -->
                <div class="xl:col-span-3">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Order Book -->
                        <div class="lg:col-span-1">
                            <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                                <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-sm font-bold text-gray-900">Order Book</h3>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-green-600 font-bold">BTC/USDT</span>
                                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3">
                                    <!-- Sell Orders -->
                                    <div class="mb-3">
                                        <div class="text-xs text-red-600 font-semibold mb-2">Sell Orders</div>
                                        <div class="space-y-1" id="sell-orders">
                                            <div class="grid grid-cols-3 text-xs">
                                                <span class="text-red-600 font-mono">43,265.42</span>
                                                <span class="text-gray-600 font-mono text-right">0.1250</span>
                                                <span class="text-gray-500 font-mono text-right">$5,408</span>
                                            </div>
                                            <div class="grid grid-cols-3 text-xs">
                                                <span class="text-red-600 font-mono">43,264.18</span>
                                                <span class="text-gray-600 font-mono text-right">0.3421</span>
                                                <span class="text-gray-500 font-mono text-right">$14,792</span>
                                            </div>
                                            <div class="grid grid-cols-3 text-xs">
                                                <span class="text-red-600 font-mono">43,262.95</span>
                                                <span class="text-gray-600 font-mono text-right">0.5640</span>
                                                <span class="text-gray-500 font-mono text-right">$24,400</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Current Price -->
                                    <div class="my-3 p-2 bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg border border-emerald-200">
                                        <div class="text-center">
                                            <div class="text-lg font-bold text-emerald-600" id="current-btc-price">43,251.67</div>
                                            <div class="text-xs text-emerald-500">≈ $43,251.67</div>
                                        </div>
                                    </div>

                                    <!-- Buy Orders -->
                                    <div>
                                        <div class="text-xs text-green-600 font-semibold mb-2">Buy Orders</div>
                                        <div class="space-y-1" id="buy-orders">
                                            <div class="grid grid-cols-3 text-xs">
                                                <span class="text-green-600 font-mono">43,250.32</span>
                                                <span class="text-gray-600 font-mono text-right">0.2150</span>
                                                <span class="text-gray-500 font-mono text-right">$9,299</span>
                                            </div>
                                            <div class="grid grid-cols-3 text-xs">
                                                <span class="text-green-600 font-mono">43,249.18</span>
                                                <span class="text-gray-600 font-mono text-right">0.4231</span>
                                                <span class="text-gray-500 font-mono text-right">$18,301</span>
                                            </div>
                                            <div class="grid grid-cols-3 text-xs">
                                                <span class="text-green-600 font-mono">43,248.05</span>
                                                <span class="text-gray-600 font-mono text-right">0.6940</span>
                                                <span class="text-gray-500 font-mono text-right">$30,014</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chart & Trading Form -->
                        <div class="lg:col-span-2">
                            <!-- Price Chart -->
                            <div class="bg-white rounded-xl shadow-lg border border-gray-100 mb-6 overflow-hidden">
                                <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h3 class="text-sm font-bold text-gray-900">BTC/USDT</h3>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="text-2xl font-bold text-emerald-600">$43,251.67</span>
                                                <span class="text-sm px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg font-semibold">+2.45%</span>
                                            </div>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">1H</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">4H</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">1D</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">1W</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4">
                                    <div class="h-64 bg-gradient-to-br from-slate-50 to-gray-100 rounded-lg flex items-center justify-center">
                                        <div class="text-center">
                                            <div class="text-4xl mb-2">📈</div>
                                            <div class="text-sm text-gray-600">Advanced TradingView Chart</div>
                                            <button onclick="usePremiumFeature('Advanced Charts')" 
                                                class="mt-2 px-4 py-2 bg-gradient-to-r from-emerald-600 to-green-600 text-white text-xs font-semibold rounded-lg hover:from-emerald-700 hover:to-green-700 transition-all duration-200">
                                                🔓 Unlock Premium Charts (10 Credits)
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Trading Form -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Buy Panel -->
                                <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                                    <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-100">
                                        <h4 class="text-sm font-bold text-emerald-700">Buy BTC</h4>
                                    </div>
                                    <div class="p-4 space-y-4">
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-700 mb-2">Order Type</label>
                                            <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
                                                <option>Market</option>
                                                <option>Limit</option>
                                                <option>Stop Loss</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-700 mb-2">Price (USDT)</label>
                                            <input type="number" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="43,251.67" value="43251.67">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-700 mb-2">Amount (BTC)</label>
                                            <input type="number" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="0.00000000" step="0.00000001">
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">25%</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">50%</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">75%</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">100%</button>
                                        </div>
                                        <div class="text-xs text-gray-600">
                                            <div class="flex justify-between">
                                                <span>Total:</span>
                                                <span class="font-semibold">$0.00 USDT</span>
                                            </div>
                                            <div class="flex justify-between mt-1">
                                                <span>Available:</span>
                                                <span class="font-semibold text-emerald-600">$12,540.28 USDT</span>
                                            </div>
                                        </div>
                                        <button onclick="placeTrade('buy')" 
                                            class="w-full py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-bold rounded-lg hover:from-emerald-700 hover:to-green-700 focus:outline-none focus:ring-4 focus:ring-emerald-500/50 transition-all duration-200 transform hover:scale-[1.02]">
                                            Buy BTC
                                        </button>
                                    </div>
                                </div>

                                <!-- Sell Panel -->
                                <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                                    <div class="p-4 bg-gradient-to-r from-red-50 to-rose-50 border-b border-red-100">
                                        <h4 class="text-sm font-bold text-red-700">Sell BTC</h4>
                                    </div>
                                    <div class="p-4 space-y-4">
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-700 mb-2">Order Type</label>
                                            <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                                <option>Market</option>
                                                <option>Limit</option>
                                                <option>Stop Loss</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-700 mb-2">Price (USDT)</label>
                                            <input type="number" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="43,251.67" value="43251.67">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-700 mb-2">Amount (BTC)</label>
                                            <input type="number" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0.00000000" step="0.00000001">
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">25%</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">50%</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">75%</button>
                                            <button class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">100%</button>
                                        </div>
                                        <div class="text-xs text-gray-600">
                                            <div class="flex justify-between">
                                                <span>Total:</span>
                                                <span class="font-semibold">$0.00 USDT</span>
                                            </div>
                                            <div class="flex justify-between mt-1">
                                                <span>Available:</span>
                                                <span class="font-semibold text-orange-600">0.29054832 BTC</span>
                                            </div>
                                        </div>
                                        <button onclick="placeTrade('sell')" 
                                            class="w-full py-3 bg-gradient-to-r from-red-600 to-rose-600 text-white font-bold rounded-lg hover:from-red-700 hover:to-rose-700 focus:outline-none focus:ring-4 focus:ring-red-500/50 transition-all duration-200 transform hover:scale-[1.02]">
                                            Sell BTC
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- NUSD Swap Section (Full Width) -->
                <div class="xl:col-span-4 mt-6">
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-yellow-50 to-amber-50 border-b border-yellow-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-bold text-amber-800">🪙 NUSD (Nexus USD) Swap</h3>
                                    <p class="text-sm text-amber-700">Convert your crypto to NUSD - Each NUSD = $1 USD</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-amber-700 font-semibold">Your NUSD Balance</div>
                                    <div id="nusd-balance" class="text-2xl font-bold text-amber-800">0.00</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Swap Form -->
                                <div>
                                    <h4 class="text-md font-semibold text-gray-800 mb-4">Swap to NUSD</h4>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">From Token</label>
                                            <select id="nusd-from-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" onchange="updateNUSDRate()">
                                                <option value="ETH">Ethereum (ETH)</option>
                                                <option value="BTC">Bitcoin (BTC)</option>
                                                <option value="USDT">Tether (USDT)</option>
                                                <option value="DOGE">Dogecoin (DOGE)</option>
                                                <option value="TON">TON</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Amount to Swap</label>
                                            <div class="relative">
                                                <input type="number" id="nusd-swap-amount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="0.00" step="0.000001" oninput="updateNUSDOutput()">
                                                <div class="absolute right-3 top-2 text-sm text-gray-500" id="nusd-from-token-symbol">ETH</div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">You will receive</label>
                                            <div class="relative">
                                                <input type="text" id="nusd-output-amount" class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg" placeholder="0.00" readonly>
                                                <div class="absolute right-3 top-2 text-sm text-gray-500">NUSD</div>
                                            </div>
                                            <div class="text-xs text-gray-600 mt-1">
                                                Rate: 1 <span id="rate-from-token">ETH</span> = $<span id="exchange-rate">2,650</span> = <span id="nusd-rate">2,650</span> NUSD
                                            </div>
                                        </div>
                                        
                                        <button onclick="initiateNUSDSwap()" class="w-full py-3 bg-gradient-to-r from-amber-600 to-yellow-600 text-white font-bold rounded-lg hover:from-amber-700 hover:to-yellow-700 focus:outline-none focus:ring-4 focus:ring-amber-500/50 transition-all duration-200">
                                            🔄 Swap to NUSD
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Instructions & Recent Swaps -->
                                <div>
                                    <h4 class="text-md font-semibold text-gray-800 mb-4">How to Swap</h4>
                                    
                                    <div class="space-y-3 mb-6">
                                        <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-lg">
                                            <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold">1</div>
                                            <div class="text-sm text-blue-800">Select the token and enter amount</div>
                                        </div>
                                        
                                        <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-lg">
                                            <div class="w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold">2</div>
                                            <div class="text-sm text-green-800">Send tokens to provided address</div>
                                        </div>
                                        
                                        <div class="flex items-start space-x-3 p-3 bg-amber-50 rounded-lg">
                                            <div class="w-6 h-6 bg-amber-600 text-white rounded-full flex items-center justify-center text-xs font-bold">3</div>
                                            <div class="text-sm text-amber-800">Receive NUSD (1 NUSD = $1 USD)</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Recent NUSD Transactions -->
                                    <div>
                                        <h5 class="text-sm font-semibold text-gray-700 mb-3">Recent NUSD Swaps</h5>
                                        <div id="nusd-transactions" class="space-y-2 max-h-32 overflow-y-auto bg-gray-50 rounded-lg p-3">
                                            <div class="text-xs text-gray-500 text-center py-2">No recent transactions</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trading Panel Sidebar -->
                <div class="xl:col-span-1 space-y-6">
                    <!-- Portfolio -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-sm font-bold text-gray-900">Portfolio Balance</h3>
                        </div>
                        <div class="p-4">
                            <div class="text-center mb-4">
                                <div class="text-2xl font-bold text-gray-900">$15,832.45</div>
                                <div class="text-sm text-emerald-600 font-semibold">+$1,247.89 (+8.5%)</div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-xs font-bold text-white">₿</div>
                                        <span class="text-sm font-semibold">BTC</span>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-bold">0.29054832</div>
                                        <div class="text-xs text-gray-600">$12,564.32</div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-bold text-white">Ξ</div>
                                        <span class="text-sm font-semibold">ETH</span>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-bold">1.24573892</div>
                                        <div class="text-xs text-gray-600">$3,268.13</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Trades -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-sm font-bold text-gray-900">Recent Trades</h3>
                        </div>
                        <div class="p-4">
                            <div class="space-y-2" id="recent-trades">
                                <div class="flex justify-between text-xs">
                                    <span class="text-green-600 font-semibold">BUY</span>
                                    <span class="font-mono">43,251.67</span>
                                    <span class="font-mono text-gray-600">0.0234</span>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-red-600 font-semibold">SELL</span>
                                    <span class="font-mono">43,249.82</span>
                                    <span class="font-mono text-gray-600">0.0156</span>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-green-600 font-semibold">BUY</span>
                                    <span class="font-mono">43,248.91</span>
                                    <span class="font-mono text-gray-600">0.0445</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trading Statistics -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-sm font-bold text-gray-900">Trading Stats</h3>
                        </div>
                        <div class="p-4 space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-600">24h Volume</span>
                                <span id="trading-volume" class="text-sm font-semibold streaming-data">$2.1B</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-600">Active Pairs</span>
                                <span id="active-pairs" class="text-sm font-semibold">1,247</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-600">Market Cap</span>
                                <span id="total-market-cap" class="text-sm font-semibold streaming-data">$1.2T</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-600">Fear & Greed</span>
                                <span id="fear-greed-index" class="text-sm font-semibold text-orange-600">65 - Greed</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            </div>
        </div>
        
        <!-- Credits Tab -->
        <div id="credits-tab" class="tab-content hidden">
            <div class="max-w-6xl mx-auto">
                <!-- Credits Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-medium opacity-80">Current Credits</h3>
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                <span class="text-xl">💎</span>
                            </div>
                        </div>
                        <div class="text-3xl font-bold mb-2" id="credits-balance">100</div>
                        <div class="text-sm opacity-70">NEXUS Credits</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-medium opacity-80">Credits Used</h3>
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                <span class="text-xl">📊</span>
                            </div>
                        </div>
                        <div class="text-3xl font-bold mb-2">0</div>
                        <div class="text-sm opacity-70">This month</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-medium opacity-80">Subscription</h3>
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                <span class="text-xl">⭐</span>
                            </div>
                        </div>
                        <div class="text-xl font-bold mb-2" id="subscription-status">Free Plan</div>
                        <div class="text-sm opacity-70">Upgrade to Pro</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    <!-- Buy Credits with Fiat -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-xl font-bold text-gray-900">Buy Credits with Card</h3>
                            <p class="text-gray-600 text-sm mt-1">Purchase NEXUS credits using credit/debit card</p>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="p-4 border-2 border-gray-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200 cursor-pointer" onclick="selectCreditPackage(50, 4.99)">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900">50</div>
                                        <div class="text-xs text-gray-600 mb-2">Credits</div>
                                        <div class="text-lg font-semibold text-emerald-600">$4.99</div>
                                        <div class="text-xs text-gray-500">$0.10 per credit</div>
                                    </div>
                                </div>
                                
                                <div class="p-4 border-2 border-emerald-500 bg-emerald-50 rounded-xl cursor-pointer" onclick="selectCreditPackage(120, 9.99)">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-emerald-700">120</div>
                                        <div class="text-xs text-emerald-600 mb-2">Credits</div>
                                        <div class="text-lg font-semibold text-emerald-600">$9.99</div>
                                        <div class="text-xs text-emerald-600 font-medium">+20% Bonus</div>
                                    </div>
                                </div>
                                
                                <div class="p-4 border-2 border-gray-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200 cursor-pointer" onclick="selectCreditPackage(250, 19.99)">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900">250</div>
                                        <div class="text-xs text-gray-600 mb-2">Credits</div>
                                        <div class="text-lg font-semibold text-emerald-600">$19.99</div>
                                        <div class="text-xs text-green-600 font-medium">+25% Bonus</div>
                                    </div>
                                </div>
                                
                                <div class="p-4 border-2 border-gray-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 transition-all duration-200 cursor-pointer" onclick="selectCreditPackage(550, 39.99)">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900">550</div>
                                        <div class="text-xs text-gray-600 mb-2">Credits</div>
                                        <div class="text-lg font-semibold text-emerald-600">$39.99</div>
                                        <div class="text-xs text-green-600 font-medium">+30% Bonus</div>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="processFiatPurchase()" 
                                class="w-full py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-700 hover:to-green-700 focus:outline-none focus:ring-4 focus:ring-emerald-500/50 transform hover:scale-[1.02] transition-all duration-200">
                                Purchase with Card
                            </button>
                        </div>
                    </div>
                    
                    <!-- Buy Credits with Crypto -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-xl font-bold text-gray-900">Buy Credits with Crypto</h3>
                            <p class="text-gray-600 text-sm mt-1">Purchase using your cryptocurrency wallet</p>
                        </div>
                        
                        <div class="p-6 space-y-6">
                            <!-- Amount Selection -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Select Amount</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button onclick="selectCryptoAmount(100)" class="p-3 border border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 text-center transition-all duration-200">
                                        <div class="font-bold">100</div>
                                        <div class="text-xs text-gray-600">Credits</div>
                                    </button>
                                    <button onclick="selectCryptoAmount(250)" class="p-3 border border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 text-center transition-all duration-200">
                                        <div class="font-bold">250</div>
                                        <div class="text-xs text-gray-600">Credits</div>
                                    </button>
                                    <button onclick="selectCryptoAmount(500)" class="p-3 border border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 text-center transition-all duration-200">
                                        <div class="font-bold">500</div>
                                        <div class="text-xs text-gray-600">Credits</div>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Crypto Selection -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Payment Method</label>
                                <div class="space-y-3">
                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="crypto-method" value="ethereum" class="mr-3">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-xl">Ξ</span>
                                            <div>
                                                <div class="font-medium">Ethereum (ETH)</div>
                                                <div class="text-sm text-gray-600" id="eth-price">~0.0025 ETH</div>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="crypto-method" value="bitcoin" class="mr-3">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-xl">₿</span>
                                            <div>
                                                <div class="font-medium">Bitcoin (BTC)</div>
                                                <div class="text-sm text-gray-600" id="btc-price">~0.00011 BTC</div>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="radio" name="crypto-method" value="usdt" class="mr-3">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-xl">₮</span>
                                            <div>
                                                <div class="font-medium">USDT (Tether)</div>
                                                <div class="text-sm text-gray-600" id="usdt-price">~5.00 USDT</div>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <button onclick="processCryptoPurchase()" 
                                class="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-500/50 transform hover:scale-[1.02] transition-all duration-200">
                                Pay with Crypto
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Subscription Plans -->
                <div class="mt-8">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                            <h3 class="text-xl font-bold text-gray-900">Subscription Plans</h3>
                            <p class="text-gray-600 text-sm mt-1">Unlock premium features with monthly credits included</p>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Free Plan -->
                                <div class="border-2 border-gray-200 rounded-xl p-6">
                                    <div class="text-center mb-6">
                                        <h4 class="text-xl font-bold text-gray-900">Free</h4>
                                        <div class="text-3xl font-bold text-gray-900 mt-2">$0<span class="text-lg text-gray-600">/month</span></div>
                                    </div>
                                    <ul class="space-y-3 mb-6">
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Basic market data
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Wallet creation
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            5 API calls/minute
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-gray-400 mr-2">✗</span>
                                            <span class="text-gray-400">Advanced analytics</span>
                                        </li>
                                    </ul>
                                    <button class="w-full py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg">
                                        Current Plan
                                    </button>
                                </div>
                                
                                <!-- Pro Plan -->
                                <div class="border-2 border-blue-500 rounded-xl p-6 relative">
                                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white px-3 py-1 rounded-full text-xs font-semibold">
                                        Most Popular
                                    </div>
                                    <div class="text-center mb-6">
                                        <h4 class="text-xl font-bold text-gray-900">Pro</h4>
                                        <div class="text-3xl font-bold text-blue-600 mt-2">$19.99<span class="text-lg text-gray-600">/month</span></div>
                                    </div>
                                    <ul class="space-y-3 mb-6">
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Everything in Free
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            500 credits/month
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Advanced analytics
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            AI trading signals
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Priority support
                                        </li>
                                    </ul>
                                    <button onclick="upgradeToProPlan()" class="w-full py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200">
                                        Upgrade to Pro
                                    </button>
                                </div>
                                
                                <!-- Enterprise Plan -->
                                <div class="border-2 border-gray-200 rounded-xl p-6">
                                    <div class="text-center mb-6">
                                        <h4 class="text-xl font-bold text-gray-900">Enterprise</h4>
                                        <div class="text-3xl font-bold text-gray-900 mt-2">$99.99<span class="text-lg text-gray-600">/month</span></div>
                                    </div>
                                    <ul class="space-y-3 mb-6">
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Everything in Pro
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            5000 credits/month
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            White-label solution
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Custom integrations
                                        </li>
                                        <li class="flex items-center text-sm">
                                            <span class="text-green-500 mr-2">✓</span>
                                            Dedicated support
                                        </li>
                                    </ul>
                                    <button onclick="contactEnterprise()" class="w-full py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-200">
                                        Contact Sales
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Features Marketplace Tab -->
        <div id="features-tab" class="tab-content hidden">
            <div class="max-w-6xl mx-auto">
                <!-- Features Header -->
                <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-8 mb-8 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold mb-2">🛍️ Features Marketplace</h1>
                            <p class="text-purple-100">Unlock premium features with NUSD payments</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-purple-200">Your NUSD Balance</div>
                            <div id="user-nusd-balance" class="text-2xl font-bold">0.00 NUSD</div>
                            <button onclick="addDemoNUSD()" 
                                class="mt-2 px-4 py-2 bg-white bg-opacity-20 text-white text-sm font-medium rounded-lg hover:bg-opacity-30 transition-all duration-200">
                                Get Demo NUSD
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Feature Categories -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">📊</span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Analytics</h3>
                            <p class="text-sm text-gray-600">Advanced portfolio tracking and market insights</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">🔔</span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Alerts</h3>
                            <p class="text-sm text-gray-600">Smart notifications and price alerts</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-violet-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">🤖</span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">AI Tools</h3>
                            <p class="text-sm text-gray-600">AI-powered trading recommendations</p>
                        </div>
                    </div>
                </div>

                <!-- Available Features -->
                <div class="space-y-6">
                    <!-- Premium Portfolio Analytics -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-3">
                                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-4">
                                            <span class="text-xl">📈</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-900">Premium Portfolio Analytics</h3>
                                            <p class="text-sm text-gray-600">Advanced portfolio tracking with detailed insights</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Real-time P&L tracking
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Asset allocation analysis
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Risk assessment tools
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Historical performance charts
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Tax reporting tools
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Custom dashboards
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-right ml-6">
                                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-4 mb-4">
                                        <div class="text-2xl font-bold text-purple-600">50 NUSD</div>
                                        <div class="text-sm text-gray-600">One-time purchase</div>
                                    </div>
                                    <button onclick="purchaseFeature('premium-analytics', 50)" 
                                        class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all duration-200">
                                        Purchase with NUSD
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Trading Assistant -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-3">
                                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg flex items-center justify-center mr-4">
                                            <span class="text-xl">🤖</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-900">AI Trading Assistant</h3>
                                            <p class="text-sm text-gray-600">Get AI-powered trading recommendations</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Market sentiment analysis
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Trading signal alerts
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Risk management advice
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Portfolio optimization
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Market timing insights
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                24/7 AI support
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-right ml-6">
                                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 mb-4">
                                        <div class="text-2xl font-bold text-green-600">25 NUSD</div>
                                        <div class="text-sm text-gray-600">Monthly subscription</div>
                                    </div>
                                    <button onclick="purchaseFeature('ai-assistant', 25)" 
                                        class="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-semibold rounded-lg hover:from-green-700 hover:to-emerald-700 focus:outline-none focus:ring-2 focus:ring-green-500/50 transition-all duration-200">
                                        Subscribe with NUSD
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Price Alerts -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-3">
                                        <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-600 rounded-lg flex items-center justify-center mr-4">
                                            <span class="text-xl">🔔</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-900">Advanced Price Alerts</h3>
                                            <p class="text-sm text-gray-600">Smart notifications for market movements</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Custom price targets
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Volume-based alerts
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Technical indicator alerts
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                SMS & Email notifications
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Whale movement alerts
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                News sentiment alerts
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-right ml-6">
                                    <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-4 mb-4">
                                        <div class="text-2xl font-bold text-orange-600">15 NUSD</div>
                                        <div class="text-sm text-gray-600">Monthly subscription</div>
                                    </div>
                                    <button onclick="purchaseFeature('price-alerts', 15)" 
                                        class="w-full px-6 py-3 bg-gradient-to-r from-orange-600 to-red-600 text-white font-semibold rounded-lg hover:from-orange-700 hover:to-red-700 focus:outline-none focus:ring-2 focus:ring-orange-500/50 transition-all duration-200">
                                        Subscribe with NUSD
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Professional Charts -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-3">
                                        <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center mr-4">
                                            <span class="text-xl">📊</span>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-900">Professional Charts</h3>
                                            <p class="text-sm text-gray-600">Advanced charting tools and indicators</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                100+ technical indicators
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Multiple timeframes
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Drawing tools
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Custom chart layouts
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Save chart templates
                                            </div>
                                            <div class="flex items-center text-sm text-gray-700">
                                                <span class="text-green-500 mr-2">✓</span>
                                                Real-time data feeds
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-right ml-6">
                                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4 mb-4">
                                        <div class="text-2xl font-bold text-indigo-600">30 NUSD</div>
                                        <div class="text-sm text-gray-600">Monthly subscription</div>
                                    </div>
                                    <button onclick="purchaseFeature('pro-charts', 30)" 
                                        class="w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all duration-200">
                                        Subscribe with NUSD
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purchased Features -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Your Active Features</h2>
                    <div id="purchased-features" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-50 rounded-xl p-6 text-center">
                            <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">🛒</span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">No Features Yet</h3>
                            <p class="text-sm text-gray-600">Purchase features above to get started</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Developers Tab -->
        <div id="developers-tab" class="tab-content hidden">
            <div class="max-w-6xl mx-auto">
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                    <!-- API Documentation -->
                    <div class="xl:col-span-2 space-y-8">
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="p-6 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                <h3 class="text-xl font-bold text-gray-900">NEXUS API Documentation</h3>
                                <p class="text-gray-600 text-sm mt-1">Build amazing applications on top of our multi-blockchain platform</p>
                            </div>
                            
                            <div class="p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <a href="#" onclick="showAPISection('quickstart')" class="p-4 border border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all duration-200">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                                <span class="text-green-600 text-lg">🚀</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Quick Start</h4>
                                                <p class="text-sm text-gray-600">Get up and running in 5 minutes</p>
                                            </div>
                                        </div>
                                    </a>
                                    
                                    <a href="#" onclick="showAPISection('wallet')" class="p-4 border border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all duration-200">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <span class="text-blue-600 text-lg">💳</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Wallet APIs</h4>
                                                <p class="text-sm text-gray-600">HD wallet generation & management</p>
                                            </div>
                                        </div>
                                    </a>
                                    
                                    <a href="#" onclick="showAPISection('transaction')" class="p-4 border border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all duration-200">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                                <span class="text-purple-600 text-lg">⚡</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Transactions</h4>
                                                <p class="text-sm text-gray-600">Send, receive, and track transactions</p>
                                            </div>
                                        </div>
                                    </a>
                                    
                                    <a href="#" onclick="showAPISection('market')" class="p-4 border border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all duration-200">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                                <span class="text-orange-600 text-lg">📊</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Market Data</h4>
                                                <p class="text-sm text-gray-600">Real-time prices and analytics</p>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                
                                <!-- API Example -->
                                <div class="bg-gray-900 rounded-xl p-6" id="api-example">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-white font-semibold">Example: Create Wallet</h4>
                                        <button onclick="copyAPIExample()" class="text-gray-400 hover:text-white">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <pre class="text-green-400 text-sm overflow-x-auto"><code>curl -X POST 'https://api.nexus.dev/v1/wallet/create' \\
  -H 'Authorization: Bearer YOUR_API_KEY' \\
  -H 'Content-Type: application/json' \\
  -d '{
    "networks": ["ethereum", "bitcoin", "ton", "dogecoin"],
    "secure": true
  }'

# Response
{
  "success": true,
  "data": {
    "mnemonic": "abandon ability able about above...",
    "addresses": {
      "ethereum": "0x742d35Cc6634C0532925a3b8D...",
      "bitcoin": "1BvBMSEYstWetqTFn5Au4m4GFg7...",
      "ton": "EQD-cvR0Nz6XAY...",
      "dogecoin": "D7P3PjLSqG6k4..."
    }
  }
}</code></pre>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SDKs and Libraries -->
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="p-6 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                <h3 class="text-xl font-bold text-gray-900">SDKs & Libraries</h3>
                                <p class="text-gray-600 text-sm mt-1">Official libraries for popular programming languages</p>
                            </div>
                            
                            <div class="p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="p-4 border border-gray-200 rounded-xl">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                                <span class="text-yellow-600 font-bold text-sm">JS</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">JavaScript/Node.js</h4>
                                                <p class="text-sm text-gray-600">npm install @nexus/sdk</p>
                                            </div>
                                        </div>
                                        <button onclick="downloadSDK('javascript')" class="w-full py-2 bg-yellow-100 text-yellow-800 font-medium rounded-lg hover:bg-yellow-200 transition-all duration-200">
                                            Download SDK
                                        </button>
                                    </div>
                                    
                                    <div class="p-4 border border-gray-200 rounded-xl">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <span class="text-blue-600 font-bold text-sm">PY</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Python</h4>
                                                <p class="text-sm text-gray-600">pip install nexus-sdk</p>
                                            </div>
                                        </div>
                                        <button onclick="downloadSDK('python')" class="w-full py-2 bg-blue-100 text-blue-800 font-medium rounded-lg hover:bg-blue-200 transition-all duration-200">
                                            Download SDK
                                        </button>
                                    </div>
                                    
                                    <div class="p-4 border border-gray-200 rounded-xl">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                                <span class="text-green-600 font-bold text-sm">GO</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Go</h4>
                                                <p class="text-sm text-gray-600">go get github.com/nexus/go-sdk</p>
                                            </div>
                                        </div>
                                        <button onclick="downloadSDK('go')" class="w-full py-2 bg-green-100 text-green-800 font-medium rounded-lg hover:bg-green-200 transition-all duration-200">
                                            Download SDK
                                        </button>
                                    </div>
                                    
                                    <div class="p-4 border border-gray-200 rounded-xl">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                                <span class="text-red-600 font-bold text-sm">RS</span>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Rust</h4>
                                                <p class="text-sm text-gray-600">cargo add nexus-sdk</p>
                                            </div>
                                        </div>
                                        <button onclick="downloadSDK('rust')" class="w-full py-2 bg-red-100 text-red-800 font-medium rounded-lg hover:bg-red-200 transition-all duration-200">
                                            Download SDK
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Developer Resources -->
                    <div class="space-y-6">
                        <!-- API Keys -->
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                <h3 class="text-lg font-bold text-gray-900">API Keys</h3>
                            </div>
                            <div class="p-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Production Key</label>
                                    <div class="flex space-x-2">
                                        <input type="password" id="prod-api-key" value="nx_prod_1234567890abcdef" readonly
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-gray-50">
                                        <button onclick="toggleAPIKeyVisibility('prod-api-key')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
                                            👁️
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Test Key</label>
                                    <div class="flex space-x-2">
                                        <input type="password" id="test-api-key" value="nx_test_abcdef1234567890" readonly
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-gray-50">
                                        <button onclick="toggleAPIKeyVisibility('test-api-key')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
                                            👁️
                                        </button>
                                    </div>
                                </div>
                                <button onclick="regenerateAPIKey()" class="w-full py-2 bg-gradient-to-r from-red-600 to-red-700 text-white font-semibold rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200">
                                    Regenerate Keys
                                </button>
                            </div>
                        </div>
                        
                        <!-- Usage Statistics -->
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                <h3 class="text-lg font-bold text-gray-900">API Usage</h3>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Requests Today</span>
                                    <span class="font-semibold">1,247 / 10,000</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 12.47%"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 pt-4 border-t">
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-gray-900">99.9%</div>
                                        <div class="text-xs text-gray-600">Uptime</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-gray-900">45ms</div>
                                        <div class="text-xs text-gray-600">Avg Response</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Support -->
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-100">
                                <h3 class="text-lg font-bold text-gray-900">Developer Support</h3>
                            </div>
                            <div class="p-4 space-y-3">
                                <a href="#" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-all duration-200">
                                    <span class="mr-3">📚</span>
                                    <span class="font-medium text-gray-700">Documentation</span>
                                </a>
                                <a href="#" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-all duration-200">
                                    <span class="mr-3">💬</span>
                                    <span class="font-medium text-gray-700">Discord Community</span>
                                </a>
                                <a href="#" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-all duration-200">
                                    <span class="mr-3">🐛</span>
                                    <span class="font-medium text-gray-700">Report Bug</span>
                                </a>
                                <a href="#" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-all duration-200">
                                    <span class="mr-3">📧</span>
                                    <span class="font-medium text-gray-700">Contact Support</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Token Info Modal -->
    <div id="token-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-96 overflow-y-auto modal-content">
                <div class="p-6 border-b updating">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <img id="modal-coin-image" class="w-12 h-12 rounded-full" src="" alt="">
                            <div>
                                <h3 id="modal-coin-name" class="text-2xl font-bold text-gray-900"></h3>
                                <p id="modal-coin-symbol" class="text-gray-500 uppercase"></p>
                            </div>
                        </div>
                        <button onclick="closeTokenModal()" class="text-gray-400 hover:text-gray-600 text-2xl">×</button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Price Info -->
                        <div>
                            <h4 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="mr-2">💰</span>Price Information
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Current Price:</span>
                                    <span id="modal-price" class="font-semibold streaming-data">$0.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">24h Change:</span>
                                    <span id="modal-24h-change" class="font-semibold">0%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">7d Change:</span>
                                    <span id="modal-7d-change" class="font-semibold">0%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">All-Time High:</span>
                                    <span id="modal-ath" class="font-semibold">$0.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">All-Time Low:</span>
                                    <span id="modal-atl" class="font-semibold">$0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Market Data -->
                        <div>
                            <h4 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="mr-2">📊</span>Market Data
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Market Cap:</span>
                                    <span id="modal-market-cap" class="font-semibold streaming-data">$0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">24h Volume:</span>
                                    <span id="modal-volume" class="font-semibold">$0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Circulating Supply:</span>
                                    <span id="modal-supply" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Max Supply:</span>
                                    <span id="modal-max-supply" class="font-semibold">N/A</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Market Rank:</span>
                                    <span id="modal-rank" class="font-semibold">#0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Info -->
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="text-lg font-semibold mb-4 flex items-center">
                            <span class="mr-2">🔍</span>Additional Information
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div class="text-sm text-blue-600 font-medium">Price Impact</div>
                                <div id="modal-price-impact" class="text-lg font-bold text-blue-700">Low</div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="text-sm text-green-600 font-medium">Liquidity</div>
                                <div id="modal-liquidity" class="text-lg font-bold text-green-700">High</div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <div class="text-sm text-purple-600 font-medium">Volatility</div>
                                <div id="modal-volatility" class="text-lg font-bold text-purple-700">Medium</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Chart -->
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="text-lg font-semibold mb-4 flex items-center">
                            <span class="mr-2">📈</span>Live Price Chart (7 Days)
                        </h4>
                        <div id="modal-chart" class="h-48 chart-container chart-loading rounded-lg"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentTab = 'overview';
        let walletAddresses = {};
        let marketData = [];
        let currentMnemonic = null;
        let autoRefresh = true;
        let refreshInterval = null;
        let dataTimestamp = Date.now();
        let priceHistory = new Map(); // Track price changes

        // API Base URL
        const API_BASE = '/api/v1';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeLiveApp();
        });

        function initializeLiveApp() {
            // Add welcome animation
            showWelcomeAnimation();
            
            // Start live data updates
            loadMarketData();
            startLiveUpdates();
            
            // Initialize UI components
            initializeRealTimeIndicators();
            
            // Load trending coins
            loadTrendingCoins();
            
            // Show credits if user is logged in
            setTimeout(() => {
                const creditsDisplay = document.getElementById('credits-display');
                if (creditsDisplay) {
                    creditsDisplay.classList.remove('hidden');
                    creditsDisplay.classList.add('flex');
                }
            }, 1000);
            
            console.log('🚀 NEXUS Live Trading Terminal Initialized');
        }

        function showWelcomeAnimation() {
            const elements = document.querySelectorAll('.animate-slide-in-up');
            elements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(50px)';
                
                setTimeout(() => {
                    el.style.transition = 'all 0.6s ease-out';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }

        function startLiveUpdates() {
            // Update every 10 seconds for live feeling
            refreshInterval = setInterval(() => {
                if (autoRefresh) {
                    loadMarketData(true); // true = silent update
                    updateTimestamps();
                    simulateLiveActivity();
                }
            }, 10000);
        }

        function simulateLiveActivity() {
            // Add random micro-animations to make it feel alive
            const streamingElements = document.querySelectorAll('.streaming-data');
            streamingElements.forEach(el => {
                if (Math.random() > 0.8) { // 20% chance
                    el.classList.add('animate-price-flash');
                    setTimeout(() => el.classList.remove('animate-price-flash'), 800);
                }
            });
        }

        function updateTimestamps() {
            const now = Date.now();
            const diff = Math.floor((now - dataTimestamp) / 1000);
            
            const timestampElements = ['data-freshness', 'last-update'];
            timestampElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (diff < 60) {
                        el.textContent = `${diff}s ago`;
                    } else {
                        el.textContent = `${Math.floor(diff / 60)}m ago`;
                    }
                }
            });
        }

        function initializeRealTimeIndicators() {
            // Add pulsing effect to live indicators
            const indicators = document.querySelectorAll('.live-indicator');
            indicators.forEach(indicator => {
                setInterval(() => {
                    indicator.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        indicator.style.transform = 'scale(1)';
                    }, 200);
                }, 2000 + Math.random() * 3000); // Random pulse between 2-5 seconds
            });
        }

        async function loadTrendingCoins() {
            try {
                const response = await fetch(`${API_BASE}/market/trending`);
                const result = await response.json();
                
                if (result.success) {
                    updateTrendingCoins(result.data?.coins || []);
                } else {
                    updateTrendingCoins(getMockTrendingCoins());
                }
            } catch (error) {
                console.error('Failed to load trending coins:', error);
                updateTrendingCoins(getMockTrendingCoins());
            }
        }

        function getMockTrendingCoins() {
            return [
                { name: 'Bitcoin', symbol: 'BTC', price_change: 3.2, thumb: '₿', price: '$43,249' },
                { name: 'Ethereum', symbol: 'ETH', price_change: -1.5, thumb: 'Ξ', price: '$2,647' },
                { name: 'Solana', symbol: 'SOL', price_change: 8.7, thumb: '◎', price: '$98.45' },
                { name: 'Dogecoin', symbol: 'DOGE', price_change: 15.3, thumb: '🐶', price: '$0.085' },
                { name: 'Avalanche', symbol: 'AVAX', price_change: -2.1, thumb: '🔺', price: '$36.22' },
                { name: 'Chainlink', symbol: 'LINK', price_change: 5.8, thumb: '🔗', price: '$14.67' }
            ];
        }

        function updateTrendingCoins(coins) {
            const container = document.getElementById('trending-coins');
            if (!container) return;
            
            container.innerHTML = '';
            
            const validCoins = (coins || getMockTrendingCoins()).slice(0, 6);
            
            validCoins.forEach((coin, index) => {
                if (!coin || !coin.name || !coin.symbol) return;
                
                const change = parseFloat(coin.price_change) || (Math.random() - 0.5) * 10;
                const price = coin.price || coin.current_price || '$0.00';
                const isPositive = change >= 0;
                
                const coinEl = document.createElement('div');
                coinEl.className = `bg-white border rounded-lg p-2 cursor-pointer hover:bg-gray-50 transition-all duration-200 animate-fade-in-scale`;
                coinEl.style.animationDelay = `${index * 0.1}s`;
                
                coinEl.innerHTML = `
                    <div class="text-center">
                        <div class="text-lg mb-1">${coin.thumb || '🪙'}</div>
                        <div class="text-xs font-medium text-gray-900 truncate">${coin.symbol.toUpperCase()}</div>
                        <div class="text-xs ${isPositive ? 'text-green-600' : 'text-red-600'} font-semibold">
                            ${isPositive ? '+' : ''}${change.toFixed(1)}%
                        </div>
                        <div class="text-xs text-gray-500 font-medium">${typeof price === 'string' ? price : '$' + price.toFixed(2)}</div>
                    </div>
                `;
                
                coinEl.onclick = () => openTokenModal(coin);
                container.appendChild(coinEl);
            });
        }

        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            event.target.classList.remove('tab-inactive');
            event.target.classList.add('tab-active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tab + '-tab').classList.remove('hidden');

            currentTab = tab;

            if (tab === 'wallet' && currentMnemonic) {
                loadWalletBalances();
            }
        }

        // Market data functions
        async function loadMarketData(silent = false) {
            if (!silent) {
                showLoadingAnimation();
            }
            
            try {
                const response = await fetch(`${API_BASE}/market/overview`);
                const result = await response.json();
                
                if (result.success) {
                    const { prices, globalStats } = result.data;
                    
                    // Update with animations
                    updateMarketDataWithAnimations(prices, marketData);
                    marketData = prices;
                    updateMarketStats(globalStats);
                    updateCoinsTable(prices);
                    
                    dataTimestamp = Date.now();
                    
                    if (!silent) {
                        showDataUpdateAnimation();
                    }
                } else {
                    throw new Error('Failed to fetch market data');
                }
            } catch (error) {
                console.error('Failed to load market data:', error);
                loadMockMarketData();
            }
        }

        function showLoadingAnimation() {
            const tables = document.querySelectorAll('.updating');
            tables.forEach(table => {
                table.classList.add('animate-pulse');
            });
        }

        function showDataUpdateAnimation() {
            const tables = document.querySelectorAll('.updating');
            tables.forEach(table => {
                table.classList.remove('animate-pulse');
                table.classList.add('animate-fade-in-scale');
                setTimeout(() => table.classList.remove('animate-fade-in-scale'), 400);
            });
            
            showNotification('📊 Market data updated!', 'success');
        }

        function updateMarketDataWithAnimations(newData, oldData) {
            newData.forEach(newCoin => {
                const oldCoin = oldData.find(c => c.id === newCoin.id);
                if (oldCoin) {
                    // Track price changes for animation
                    if (newCoin.current_price !== oldCoin.current_price) {
                        priceHistory.set(newCoin.id, {
                            old: oldCoin.current_price,
                            new: newCoin.current_price,
                            change: newCoin.current_price > oldCoin.current_price ? 'increase' : 'decrease',
                            timestamp: Date.now()
                        });
                    }
                }
            });
        }

        function refreshData() {
            const button = document.querySelector('button[onclick="refreshData()"]');
            button.classList.add('animate-bounce');
            button.innerHTML = '🔄 Refreshing...';
            
            loadMarketData().then(() => {
                button.classList.remove('animate-bounce');
                button.innerHTML = '🔄 Refresh';
                button.classList.add('success-animation');
                setTimeout(() => button.classList.remove('success-animation'), 600);
            });
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const button = document.getElementById('auto-refresh-text');
            const indicator = autoRefresh ? '⚡ Auto: ON' : '⏸️ Auto: OFF';
            button.textContent = indicator;
            
            if (autoRefresh) {
                startLiveUpdates();
                showNotification('🔄 Auto-refresh enabled', 'success');
            } else {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                showNotification('⏸️ Auto-refresh disabled', 'info');
            }
        }

        // Token Modal Functions
        function openTokenModal(coin) {
            const modal = document.getElementById('token-modal');
            
            // Populate modal with data
            document.getElementById('modal-coin-image').src = coin.image || `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23ddd"/><text x="50" y="55" text-anchor="middle" font-size="30">${coin.thumb || '🪙'}</text></svg>`;
            document.getElementById('modal-coin-name').textContent = coin.name || 'Unknown';
            document.getElementById('modal-coin-symbol').textContent = coin.symbol || 'N/A';
            
            // Price information
            document.getElementById('modal-price').textContent = formatPrice(coin.current_price || 0);
            document.getElementById('modal-24h-change').textContent = formatPercentage(coin.price_change_percentage_24h || 0);
            document.getElementById('modal-24h-change').className = `font-semibold ${(coin.price_change_percentage_24h || 0) >= 0 ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('modal-7d-change').textContent = formatPercentage(coin.price_change_percentage_7d_in_currency || 0);
            document.getElementById('modal-7d-change').className = `font-semibold ${(coin.price_change_percentage_7d_in_currency || 0) >= 0 ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('modal-ath').textContent = formatPrice(coin.ath || 0);
            document.getElementById('modal-atl').textContent = formatPrice(coin.atl || 0);
            
            // Market data
            document.getElementById('modal-market-cap').textContent = formatLargeNumber(coin.market_cap || 0);
            document.getElementById('modal-volume').textContent = formatLargeNumber(coin.total_volume || 0);
            document.getElementById('modal-supply').textContent = (coin.circulating_supply || 0).toLocaleString();
            document.getElementById('modal-max-supply').textContent = coin.max_supply ? coin.max_supply.toLocaleString() : 'N/A';
            document.getElementById('modal-rank').textContent = `#${coin.market_cap_rank || 'N/A'}`;
            
            // Additional info (mock data for demo)
            const volatility = Math.random() > 0.5 ? 'High' : Math.random() > 0.5 ? 'Medium' : 'Low';
            const liquidity = Math.random() > 0.3 ? 'High' : 'Medium';
            const priceImpact = Math.random() > 0.7 ? 'High' : Math.random() > 0.5 ? 'Medium' : 'Low';
            
            document.getElementById('modal-volatility').textContent = volatility;
            document.getElementById('modal-liquidity').textContent = liquidity;
            document.getElementById('modal-price-impact').textContent = priceImpact;
            
            // Create mini chart
            createMiniChart(coin);
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeTokenModal() {
            const modal = document.getElementById('token-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function createMiniChart(coin) {
            const container = document.getElementById('modal-chart');
            container.innerHTML = '';
            container.classList.remove('chart-loading');
            
            // Create a simple canvas chart
            const canvas = document.createElement('canvas');
            canvas.width = container.clientWidth;
            canvas.height = 192; // h-48
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            const prices = coin.sparkline_in_7d?.price || generateMockPriceData();
            
            if (prices.length > 0) {
                drawLineChart(ctx, prices, canvas.width, canvas.height);
            }
        }

        function generateMockPriceData() {
            const data = [];
            const basePrice = 100;
            for (let i = 0; i < 168; i++) { // 7 days * 24 hours
                data.push(basePrice + Math.sin(i * 0.1) * 20 + (Math.random() - 0.5) * 10);
            }
            return data;
        }

        function drawLineChart(ctx, prices, width, height) {
            const padding = 20;
            const chartWidth = width - (padding * 2);
            const chartHeight = height - (padding * 2);
            
            const min = Math.min(...prices);
            const max = Math.max(...prices);
            const range = max - min;
            
            if (range === 0) return;
            
            ctx.clearRect(0, 0, width, height);
            
            // Background
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(0, 0, width, height);
            
            // Grid lines
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            for (let i = 1; i < 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // Price line
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            prices.forEach((price, i) => {
                const x = padding + (i / (prices.length - 1)) * chartWidth;
                const y = padding + chartHeight - ((price - min) / range) * chartHeight;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Fill area under curve
            ctx.fillStyle = 'rgba(59, 130, 246, 0.1)';
            ctx.lineTo(width - padding, height - padding);
            ctx.lineTo(padding, height - padding);
            ctx.closePath();
            ctx.fill();
        }

        function loadMockMarketData() {
            const mockData = [
                {
                    id: 'bitcoin',
                    symbol: 'btc',
                    name: 'Bitcoin',
                    image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png',
                    current_price: 43250.67,
                    market_cap_rank: 1,
                    price_change_percentage_24h: 2.98,
                    price_change_percentage_7d_in_currency: 5.67,
                    market_cap: 847123456789,
                    total_volume: 23456789012,
                    sparkline_in_7d: { price: Array.from({length: 168}, (_, i) => 43000 + Math.sin(i * 0.1) * 2000) }
                },
                {
                    id: 'ethereum',
                    symbol: 'eth',
                    name: 'Ethereum',
                    image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png',
                    current_price: 2650.34,
                    market_cap_rank: 2,
                    price_change_percentage_24h: 2.63,
                    price_change_percentage_7d_in_currency: 4.23,
                    market_cap: 318567890123,
                    total_volume: 15678901234,
                    sparkline_in_7d: { price: Array.from({length: 168}, (_, i) => 2600 + Math.sin(i * 0.15) * 150) }
                }
            ];
            updateCoinsTable(mockData);
        }

        function updateMarketStats(globalStats) {
            const stats = globalStats?.data || globalStats;
            if (!stats) return;

            if (stats.active_cryptocurrencies) {
                document.getElementById('active-cryptos').textContent = stats.active_cryptocurrencies.toLocaleString();
            }
            if (stats.total_volume?.usd) {
                document.getElementById('total-volume').textContent = formatLargeNumber(stats.total_volume.usd);
            }
            if (stats.market_cap_percentage?.btc) {
                document.getElementById('btc-dominance').textContent = `${stats.market_cap_percentage.btc.toFixed(1)}%`;
            }
            if (stats.market_cap_change_percentage_24h_usd) {
                const changeEl = document.getElementById('market-cap-change');
                const change = stats.market_cap_change_percentage_24h_usd;
                changeEl.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeEl.className = change > 0 ? 'text-2xl font-bold green-text' : 'text-2xl font-bold red-text';
            }
            if (stats.total_market_cap?.usd) {
                document.getElementById('total-market-cap').textContent = formatLargeNumber(stats.total_market_cap.usd);
            }
        }

        function updateCoinsTable(coins) {
            const tbody = document.getElementById('coins-table');
            tbody.innerHTML = '';

            coins.forEach(coin => {
                const row = createCoinRow(coin);
                tbody.appendChild(row);
            });
        }

        function createCoinRow(coin) {
            const row = document.createElement('tr');
            row.className = 'coin-row hover:bg-gray-50 cursor-pointer';
            
            const price24h = coin.price_change_percentage_24h || 0;
            const price7d = coin.price_change_percentage_7d_in_currency || 0;
            const price1h = (Math.random() - 0.5) * 5; // Mock 1h data
            
            row.innerHTML = `
                <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900 font-medium">
                    ${coin.market_cap_rank || '-'}
                </td>
                <td class="px-4 py-2 whitespace-nowrap">
                    <div class="flex items-center">
                        <img class="h-6 w-6 rounded-full mr-2" src="${coin.image || ''}" alt="${coin.name}" 
                             onerror="handleImageError(this, '${coin.symbol}')">
                        <div>
                            <div class="text-sm font-semibold text-gray-900">${coin.name}</div>
                            <div class="text-xs text-gray-500 uppercase font-medium">${coin.symbol}</div>
                        </div>
                    </div>
                </td>
                <td class="px-3 py-2 whitespace-nowrap text-right text-sm font-bold text-gray-900">
                    ${formatPrice(coin.current_price)}
                </td>
                <td class="px-2 py-2 whitespace-nowrap text-right text-xs">
                    <span class="px-1.5 py-0.5 rounded text-xs font-medium ${price1h >= 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${formatPercentage(price1h)}
                    </span>
                </td>
                <td class="px-2 py-2 whitespace-nowrap text-right text-xs">
                    <span class="px-1.5 py-0.5 rounded text-xs font-medium ${price24h >= 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${formatPercentage(price24h)}
                    </span>
                </td>
                <td class="px-2 py-2 whitespace-nowrap text-right text-xs">
                    <span class="px-1.5 py-0.5 rounded text-xs font-medium ${price7d >= 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${formatPercentage(price7d)}
                    </span>
                </td>
                <td class="px-3 py-2 whitespace-nowrap text-right text-sm text-gray-700 font-semibold">
                    ${formatLargeNumber(coin.market_cap)}
                </td>
                <td class="px-3 py-2 whitespace-nowrap text-right text-sm text-gray-600">
                    ${formatLargeNumber(coin.total_volume)}
                </td>
                <td class="px-3 py-2 whitespace-nowrap text-center">
                    <div class="sparkline-container mx-auto">
                        <canvas id="sparkline-${coin.id}" width="80" height="30"></canvas>
                    </div>
                </td>
            `;
            
            // Add sparkline after DOM insertion
            setTimeout(() => drawSparkline(coin.id, coin.sparkline_in_7d?.price || []), 10);
            
            return row;
        }

        function drawSparkline(coinId, prices) {
            const canvas = document.getElementById(`sparkline-${coinId}`);
            if (!canvas || !prices.length) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            const min = Math.min(...prices);
            const max = Math.max(...prices);
            const range = max - min;
            
            if (range === 0) return;
            
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = prices[prices.length - 1] > prices[0] ? '#16a34a' : '#dc2626';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            
            prices.forEach((price, i) => {
                const x = (i / (prices.length - 1)) * width;
                const y = height - ((price - min) / range) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }

        // Wallet functions
        async function generateNewWallet() {
            try {
                console.log('Generating wallet, API_BASE:', API_BASE);
                const response = await fetch(`${API_BASE}/wallet/generate-mnemonic`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: '{}'
                });
                
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('Response result:', result);
                
                if (result.success) {
                    const walletData = result.data;
                    console.log('Generated wallet data:', walletData);
                    
                    // Store wallet data
                    localStorage.setItem('currentWallet', JSON.stringify(walletData));
                    
                    // Display detailed wallet information
                    displayDetailedWalletInfo(walletData);
                    
                    // Update the mnemonic field if it exists
                    const mnemonicElement = document.getElementById('import-mnemonic');
                    if (mnemonicElement) {
                        mnemonicElement.value = walletData.mnemonic;
                    }
                    
                    showNotification('New wallet generated with detailed information!', 'success');
                } else {
                    throw new Error(result.error || 'Failed to generate wallet');
                }
            } catch (error) {
                console.error('Generate wallet error:', error);
                showNotification('Failed to generate wallet: ' + error.message, 'error');
            }
        }

        async function importWallet() {
            const mnemonic = document.getElementById('import-mnemonic').value.trim();
            if (!mnemonic) {
                showNotification('Please enter a mnemonic phrase', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/wallet/derive-all-addresses`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mnemonic, count: 1 })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentMnemonic = mnemonic;
                    walletAddresses = result.data?.addresses || {};
                    displayAddresses();
                    loadWalletBalances();
                    showNotification('Wallet imported successfully!', 'success');
                } else {
                    throw new Error(result.error || 'Failed to import wallet');
                }
            } catch (error) {
                console.error('Import wallet error:', error);
                showNotification('Failed to import wallet: ' + error.message, 'error');
            }
        }

        async function importFromPrivateKey() {
            const privateKey = document.getElementById('private-key-input').value.trim();
            const blockchain = document.getElementById('blockchain-select').value;
            
            if (!privateKey || !blockchain) {
                showNotification('Please enter private key and select blockchain', 'error');
                return;
            }

            showNotification('Private key import functionality coming soon!', 'info');
        }

        async function lookupAddress() {
            const address = document.getElementById('address-input').value.trim();
            if (!address) {
                showNotification('Please enter an address', 'error');
                return;
            }

            showNotification('Address lookup functionality coming soon!', 'info');
        }

        function displayAddresses() {
            const container = document.getElementById('addresses-display');
            container.innerHTML = '';

            for (const [blockchain, addresses] of Object.entries(walletAddresses)) {
                if (addresses && addresses.length > 0) {
                    addresses.forEach(addr => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border';
                        div.innerHTML = `
                            <div>
                                <div class="text-sm font-medium text-gray-900">${blockchain}</div>
                                <div class="text-xs text-gray-500 font-mono">${addr.address}</div>
                                <div class="text-xs text-gray-400">${addr.derivationPath}</div>
                            </div>
                            <button onclick="copyToClipboard('${addr.address}')" 
                                class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                Copy
                            </button>
                        `;
                        container.appendChild(div);
                    });
                }
            }

            if (container.children.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No addresses found</div>';
            }
        }

        async function loadWalletBalances() {
            const container = document.getElementById('balances-display');
            container.innerHTML = '<div class="text-center text-gray-500 py-4">Loading balances...</div>';

            const balances = [];
            for (const [blockchain, addresses] of Object.entries(walletAddresses)) {
                if (addresses && addresses.length > 0) {
                    for (const addr of addresses) {
                        try {
                            const response = await fetch(`${API_BASE}/blockchain/balance/${blockchain}/${addr.address}`);
                            const result = await response.json();
                            
                            if (result.success) {
                                balances.push({
                                    blockchain,
                                    address: addr.address,
                                    balance: result.data
                                });
                            }
                        } catch (error) {
                            console.error(`Failed to load balance for ${blockchain}:`, error);
                        }
                    }
                }
            }

            displayBalances(balances);
        }

        function displayBalances(balances) {
            const container = document.getElementById('balances-display');
            container.innerHTML = '';

            balances.forEach(bal => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border';
                div.innerHTML = `
                    <div>
                        <div class="text-sm font-medium text-gray-900">${bal.blockchain}</div>
                        <div class="text-xs text-gray-500 font-mono">${bal.address.substring(0, 20)}...</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-semibold">${bal.balance.formattedBalance || '0.0'}</div>
                        <div class="text-xs text-gray-500">${bal.balance.balance} raw</div>
                    </div>
                `;
                container.appendChild(div);
            });

            if (balances.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No balances found</div>';
            }
        }

        function clearWallet() {
            document.getElementById('import-mnemonic').value = '';
            document.getElementById('private-key-input').value = '';
            document.getElementById('address-input').value = '';
            currentMnemonic = null;
            walletAddresses = {};
            
            document.getElementById('addresses-display').innerHTML = '<div class="text-center text-gray-500 py-8">No wallet loaded</div>';
            document.getElementById('balances-display').innerHTML = '<div class="text-center text-gray-500 py-8">No balances available</div>';
            
            showNotification('Wallet cleared', 'info');
        }

        // Trading functions
        async function estimateGas() {
            const fromAddr = document.getElementById('from-address').value;
            const toAddr = document.getElementById('to-address').value;
            const amount = document.getElementById('send-amount').value;
            const blockchain = document.getElementById('send-blockchain').value;
            
            if (!fromAddr || !toAddr || !amount || !blockchain) {
                showNotification('Please fill all fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/blockchain/estimate-fee`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        blockchain,
                        from: fromAddr,
                        to: toAddr,
                        value: amount
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('gas-fee').value = result.data.fee + ' wei/sat';
                } else {
                    throw new Error(result.error || 'Failed to estimate gas');
                }
            } catch (error) {
                console.error('Gas estimation error:', error);
                showNotification('Failed to estimate gas: ' + error.message, 'error');
            }
        }

        function sendTransaction() {
            showNotification('Transaction functionality coming soon!', 'info');
        }

        // Utility functions
        function formatPrice(price) {
            if (price < 0.01) {
                return `$${price.toFixed(6)}`;
            } else if (price < 1) {
                return `$${price.toFixed(4)}`;
            } else if (price < 100) {
                return `$${price.toFixed(2)}`;
            } else {
                return `$${price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
        }

        function formatLargeNumber(num) {
            if (num >= 1e12) {
                return `$${(num / 1e12).toFixed(2)}T`;
            } else if (num >= 1e9) {
                return `$${(num / 1e9).toFixed(2)}B`;
            } else if (num >= 1e6) {
                return `$${(num / 1e6).toFixed(2)}M`;
            } else {
                return `$${num.toLocaleString()}`;
            }
        }

        function formatPercentage(percentage) {
            const formatted = Math.abs(percentage).toFixed(2);
            return `${percentage >= 0 ? '+' : '-'}${formatted}%`;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('Failed to copy', 'error');
            });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Credit & Login System
        let currentUser = null;
        let userCredits = 0;

        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('credit-store').classList.add('hidden');
        }

        function performLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showNotification('Please enter both email and password', 'error');
                return;
            }

            // Mock login - in real app, this would call your auth API
            currentUser = {
                id: 'user_' + Math.random().toString(36).substr(2, 9),
                email: email,
                name: email.split('@')[0] || 'User',
                credits: 100 // Welcome bonus
            };
            userCredits = currentUser.credits;

            // Update UI
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-avatar').textContent = currentUser.name[0].toUpperCase();
            document.getElementById('user-credits').textContent = currentUser.credits + ' 🪙';
            document.getElementById('login-text').textContent = currentUser.name;
            
            // Show profile, hide form
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('user-profile').classList.remove('hidden');
            
            showNotification(`Welcome ${currentUser.name}! You received 100 free credits! 🎉`, 'success');
            
            // Show credits in header
            document.getElementById('credits-display').classList.remove('hidden');
            document.getElementById('credits-display').classList.add('flex');
            document.getElementById('user-credits-header').textContent = currentUser.credits;
        }

        function showCreditStore() {
            document.getElementById('credit-store').classList.toggle('hidden');
        }

        function buyCredits(amount, price) {
            // Mock purchase - in real app, this would process payment
            userCredits += amount;
            currentUser.credits = userCredits;
            document.getElementById('user-credits').textContent = userCredits + ' 🪙';
            showNotification(`Successfully purchased ${amount} credits for $${price}! 💳`, 'success');
            document.getElementById('credit-store').classList.add('hidden');
        }

        // External Wallet Connection
        async function connectExternalWallet() {
            try {
                // Check for MetaMask
                if (typeof window.ethereum !== 'undefined') {
                    const accounts = await window.ethereum.request({ method: 'eth_request_accounts' });
                    if (accounts.length > 0) {
                        const address = accounts[0];
                        document.getElementById('wallet-connect-text').textContent = 
                            address.substring(0, 6) + '...' + address.substring(address.length - 4);
                        showNotification('MetaMask connected successfully! 🦊', 'success');
                        return;
                    }
                }

                // Check for other wallets
                if (window.solana && window.solana.isPhantom) {
                    const resp = await window.solana.connect();
                    const address = resp.publicKey.toString();
                    document.getElementById('wallet-connect-text').textContent = 
                        address.substring(0, 6) + '...' + address.substring(address.length - 4);
                    showNotification('Phantom Wallet connected! 👻', 'success');
                    return;
                }

                // Show wallet options modal
                showWalletOptionsModal();
                
            } catch (error) {
                console.error('Wallet connection error:', error);
                showNotification('Failed to connect wallet. Please try again.', 'error');
            }
        }

        function showWalletOptionsModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 animate-fade-in-scale">
                    <div class="p-8">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900">Connect Wallet</h2>
                            <p class="text-gray-600 mt-2">Choose your preferred wallet</p>
                        </div>
                        <div class="space-y-3">
                            <button onclick="installMetaMask()" 
                                class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all duration-200">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center mr-3">
                                        🦊
                                    </div>
                                    <div class="text-left">
                                        <div class="font-semibold text-gray-900">MetaMask</div>
                                        <div class="text-sm text-gray-600">Ethereum & EVM chains</div>
                                    </div>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                            <button onclick="installPhantom()" 
                                class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all duration-200">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mr-3">
                                        👻
                                    </div>
                                    <div class="text-left">
                                        <div class="font-semibold text-gray-900">Phantom</div>
                                        <div class="text-sm text-gray-600">Solana & SPL tokens</div>
                                    </div>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                            <button onclick="installTonKeeper()" 
                                class="w-full flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all duration-200">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                                        💎
                                    </div>
                                    <div class="text-left">
                                        <div class="font-semibold text-gray-900">TonKeeper</div>
                                        <div class="text-sm text-gray-600">TON Blockchain</div>
                                    </div>
                                </div>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                            class="w-full mt-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-all duration-200">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function installMetaMask() {
            window.open('https://metamask.io/download/', '_blank');
            showNotification('Please install MetaMask and refresh the page', 'info');
        }

        function installPhantom() {
            window.open('https://phantom.app/', '_blank');
            showNotification('Please install Phantom and refresh the page', 'info');
        }

        function installTonKeeper() {
            window.open('https://tonkeeper.com/', '_blank');
            showNotification('Please install TonKeeper and refresh the page', 'info');
        }

        // Enhanced network-specific key generation
        async function generateNetworkSpecificWallet(blockchain) {
            try {
                console.log(`🔧 Generating ${blockchain}-specific wallet...`);
                
                const response = await fetch(`${API_BASE}/wallet/generate-network-wallet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        blockchain: blockchain,
                        networkRules: true
                    })
                });

                const result = await response.json();
                if (result.success) {
                    return result.data;
                } else {
                    throw new Error(result.error || 'Failed to generate network wallet');
                }
            } catch (error) {
                console.error(`${blockchain} wallet generation error:`, error);
                throw error;
            }
        }

        // Premium feature usage
        function usePremiumFeature(featureName, cost = 10) {
            if (!currentUser) {
                showNotification('Please login to use premium features', 'error');
                showLoginModal();
                return false;
            }

            if (userCredits < cost) {
                showNotification(`Insufficient credits. Need ${cost} credits for ${featureName}`, 'error');
                showCreditStore();
                return false;
            }

            userCredits -= cost;
            currentUser.credits = userCredits;
            document.getElementById('user-credits').textContent = userCredits + ' 🪙';
            showNotification(`${featureName} activated! (${cost} credits used)`, 'success');
            return true;
        }

        // Block Explorer functionality
        function openBlockExplorer(address = null, txHash = null) {
            const network = 'ethereum'; // Default network, could be dynamic
            let url = '';

            if (txHash) {
                // Open transaction page
                switch (network) {
                    case 'ethereum':
                        url = `https://etherscan.io/tx/${txHash}`;
                        break;
                    case 'bitcoin':
                        url = `https://blockchair.com/bitcoin/transaction/${txHash}`;
                        break;
                    case 'ton':
                        url = `https://tonscan.org/tx/${txHash}`;
                        break;
                    case 'dogecoin':
                        url = `https://blockchair.com/dogecoin/transaction/${txHash}`;
                        break;
                    default:
                        url = `https://etherscan.io/tx/${txHash}`;
                }
            } else if (address) {
                // Open address page
                switch (network) {
                    case 'ethereum':
                        url = `https://etherscan.io/address/${address}`;
                        break;
                    case 'bitcoin':
                        url = `https://blockchair.com/bitcoin/address/${address}`;
                        break;
                    case 'ton':
                        url = `https://tonscan.org/address/${address}`;
                        break;
                    case 'dogecoin':
                        url = `https://blockchair.com/dogecoin/address/${address}`;
                        break;
                    default:
                        url = `https://etherscan.io/address/${address}`;
                }
            } else {
                // Open general explorer
                switch (network) {
                    case 'ethereum':
                        url = 'https://etherscan.io/';
                        break;
                    case 'bitcoin':
                        url = 'https://blockchair.com/bitcoin';
                        break;
                    case 'ton':
                        url = 'https://tonscan.org/';
                        break;
                    case 'dogecoin':
                        url = 'https://blockchair.com/dogecoin';
                        break;
                    default:
                        url = 'https://etherscan.io/';
                }
            }

            window.open(url, '_blank');
            showNotification(`Opening ${network} block explorer...`, 'info');
        }

        // Enhanced Wallet Management Functions
        let mnemonicWords = 12; // Default to 12 words
        let selectedCreditPackage = null;
        let selectedCryptoAmount = 100;

        function showCreateWalletModal() {
            // Implementation for wallet creation modal
            showNotification('Creating new wallet...', 'info');
            generateNewWallet();
        }

        function showImportWalletModal() {
            document.getElementById('import-wallet-modal').classList.remove('hidden');
            generateMnemonicGrid();
        }

        function closeImportModal() {
            document.getElementById('import-wallet-modal').classList.add('hidden');
        }

        function showPrivateKeyModal() {
            // Implementation for private key import modal
            showNotification('Private key import coming soon...', 'info');
        }

        // Handle image loading errors with fallback
        function handleImageError(img, symbol) {
            const firstLetter = symbol ? symbol.charAt(0).toUpperCase() : '?';
            const colors = {
                'B': '#f59e0b', // Bitcoin orange
                'E': '#6366f1', // Ethereum blue  
                'D': '#eab308', // Dogecoin yellow
                'T': '#0ea5e9', // TON blue
                'U': '#10b981', // USDT green
            };
            const color = colors[firstLetter] || '#6b7280';
            
            const svg = `<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="12" fill="${color}"/>
                <text x="12" y="16" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">${firstLetter}</text>
            </svg>`;
            
            img.src = 'data:image/svg+xml;base64,' + btoa(svg);
        }

        function generateMnemonicGrid() {
            const grid = document.getElementById('mnemonic-grid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= mnemonicWords; i++) {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'relative';
                inputDiv.innerHTML = `
                    <input type="text" id="word-${i}" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                        placeholder="${i}">
                    <div class="absolute top-0 right-2 text-xs text-gray-400 pointer-events-none">${i}</div>
                `;
                grid.appendChild(inputDiv);
            }
        }

        function toggleMnemonicLength() {
            mnemonicWords = mnemonicWords === 12 ? 24 : 12;
            const toggleText = document.getElementById('mnemonic-toggle-text');
            toggleText.textContent = mnemonicWords === 12 ? 'Switch to 24 words' : 'Switch to 12 words';
            generateMnemonicGrid();
        }

        function toggleAdvancedOptions() {
            const advancedOptions = document.getElementById('advanced-options');
            const toggleButton = document.getElementById('advanced-toggle');
            
            if (advancedOptions.classList.contains('hidden')) {
                advancedOptions.classList.remove('hidden');
                toggleButton.textContent = 'Hide';
            } else {
                advancedOptions.classList.add('hidden');
                toggleButton.textContent = 'Show';
            }
        }

        function importWalletFromMnemonic() {
            const words = [];
            for (let i = 1; i <= mnemonicWords; i++) {
                const word = document.getElementById(`word-${i}`).value.trim().toLowerCase();
                if (word) words.push(word);
            }

            if (words.length !== mnemonicWords) {
                showNotification(`Please enter all ${mnemonicWords} words`, 'error');
                return;
            }

            const mnemonic = words.join(' ');
            importWallet(mnemonic);
            closeImportModal();
        }

        // Credits and Subscription Functions
        function selectCreditPackage(credits, price) {
            selectedCreditPackage = { credits, price };
            showNotification(`Selected ${credits} credits for $${price}`, 'info');
        }

        function selectCryptoAmount(amount) {
            selectedCryptoAmount = amount;
            showNotification(`Selected ${amount} credits`, 'info');
        }

        function processFiatPurchase() {
            if (!selectedCreditPackage) {
                showNotification('Please select a credit package first', 'error');
                return;
            }

            // Mock payment processing
            showNotification(`Processing payment of $${selectedCreditPackage.price} for ${selectedCreditPackage.credits} credits...`, 'info');
            
            setTimeout(() => {
                userCredits += selectedCreditPackage.credits;
                updateCreditsDisplay();
                showNotification(`Successfully purchased ${selectedCreditPackage.credits} credits! 🎉`, 'success');
                selectedCreditPackage = null;
            }, 2000);
        }

        function processCryptoPurchase() {
            const selectedMethod = document.querySelector('input[name="crypto-method"]:checked')?.value;
            
            if (!selectedMethod) {
                showNotification('Please select a payment method', 'error');
                return;
            }

            // Mock crypto payment processing
            showNotification(`Initiating ${selectedMethod.toUpperCase()} payment for ${selectedCryptoAmount} credits...`, 'info');
            
            setTimeout(() => {
                userCredits += selectedCryptoAmount;
                updateCreditsDisplay();
                showNotification(`Successfully purchased ${selectedCryptoAmount} credits with ${selectedMethod.toUpperCase()}! 🎉`, 'success');
            }, 3000);
        }

        function upgradeToProPlan() {
            showNotification('Upgrading to Pro Plan...', 'info');
            
            setTimeout(() => {
                document.getElementById('subscription-status').textContent = 'Pro Plan';
                userCredits += 500; // Pro plan includes 500 credits
                updateCreditsDisplay();
                showNotification('Welcome to NEXUS Pro! 🌟', 'success');
            }, 2000);
        }

        function contactEnterprise() {
            window.open('mailto:enterprise@nexus.dev?subject=Enterprise Plan Inquiry', '_blank');
            showNotification('Opening email client...', 'info');
        }

        function updateCreditsDisplay() {
            document.getElementById('credits-balance').textContent = userCredits;
            if (document.getElementById('user-credits-header')) {
                document.getElementById('user-credits-header').textContent = userCredits;
            }
        }

        // Developer Functions
        function showAPISection(section) {
            const apiExample = document.getElementById('api-example');
            const examples = {
                quickstart: `# Install the SDK
npm install @nexus/sdk

# Initialize
const Nexus = require('@nexus/sdk');
const nexus = new Nexus('YOUR_API_KEY');

# Create your first wallet
const wallet = await nexus.wallet.create({
  networks: ['ethereum', 'bitcoin']
});

console.log('Wallet created:', wallet.addresses);`,
                
                wallet: `# Generate HD Wallet
POST /v1/wallet/create
{
  "networks": ["ethereum", "bitcoin", "ton"],
  "secure": true,
  "derivation_path": "m/44'/60'/0'/0"
}

# Import from Mnemonic  
POST /v1/wallet/import
{
  "mnemonic": "abandon ability able...",
  "networks": ["ethereum"]
}`,
                
                transaction: `# Send Transaction
POST /v1/transaction/send
{
  "from": "0x742d35Cc...",
  "to": "0x8ba1f109...", 
  "amount": "0.1",
  "network": "ethereum",
  "gas_price": "20"
}

# Get Transaction History
GET /v1/transaction/history?address=0x742d35Cc...`,
                
                market: `# Get Real-time Prices
GET /v1/market/prices?symbols=bitcoin,ethereum,dogecoin

# Get Market Data
GET /v1/market/data?symbol=bitcoin&interval=1d&limit=30

# WebSocket Real-time Updates
wss://ws.nexus.dev/v1/market/stream?symbols=bitcoin,ethereum`
            };

            apiExample.querySelector('code').textContent = examples[section] || examples.quickstart;
            showNotification(`Showing ${section} documentation`, 'info');
        }

        function copyAPIExample() {
            const codeElement = document.querySelector('#api-example code');
            navigator.clipboard.writeText(codeElement.textContent).then(() => {
                showNotification('API example copied to clipboard! 📋', 'success');
            }).catch(() => {
                showNotification('Failed to copy to clipboard', 'error');
            });
        }

        function downloadSDK(language) {
            const sdkUrls = {
                javascript: 'https://github.com/nexus-dev/nexus-js-sdk',
                python: 'https://github.com/nexus-dev/nexus-python-sdk',
                go: 'https://github.com/nexus-dev/nexus-go-sdk',
                rust: 'https://github.com/nexus-dev/nexus-rust-sdk'
            };

            window.open(sdkUrls[language], '_blank');
            showNotification(`Opening ${language} SDK repository...`, 'info');
        }

        function toggleAPIKeyVisibility(keyId) {
            const keyInput = document.getElementById(keyId);
            if (keyInput.type === 'password') {
                keyInput.type = 'text';
            } else {
                keyInput.type = 'password';
            }
        }

        function regenerateAPIKey() {
            if (confirm('Are you sure you want to regenerate your API keys? This will invalidate your current keys.')) {
                showNotification('Regenerating API keys...', 'info');
                
                setTimeout(() => {
                    document.getElementById('prod-api-key').value = 'nx_prod_' + Math.random().toString(36).substr(2, 16);
                    document.getElementById('test-api-key').value = 'nx_test_' + Math.random().toString(36).substr(2, 16);
                    showNotification('API keys regenerated successfully! 🔑', 'success');
                }, 1500);
            }
        }

        function sendTransaction() {
            const fromWallet = document.getElementById('send-from-wallet').value;
            const network = document.getElementById('send-network').value;
            const toAddress = document.getElementById('send-to-address').value;
            const amount = document.getElementById('send-amount').value;

            if (!fromWallet || !toAddress || !amount) {
                showNotification('Please fill in all transaction fields', 'error');
                return;
            }

            showNotification(`Sending ${amount} ${network.toUpperCase()} to ${toAddress.substring(0, 10)}...`, 'info');
            
            setTimeout(() => {
                showNotification('Transaction sent successfully! 🚀', 'success');
                // Clear form
                document.getElementById('send-to-address').value = '';
                document.getElementById('send-amount').value = '';
            }, 2000);
        }

        // NUSD Swap Addresses
        const NUSD_ADDRESSES = {
            usdt: 'TPw6NEgZRxEoX8s64zfCKfPjwRCHHPTjQN', // Your USDT address
            ton: 'UQA7SUW4pslVSudC0Cfi8NTQyZI1nHHi-frcp20EvQZSfn__', // Your TON address
            eth: '0x742d35Cc6669C2532C94F5f93a4e8A4b15F4c6Ef', // Example ETH address
            btc: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh', // Example BTC address
            doge: 'D7Y55nVz9nzdHzh4ZYZNX6Ak5y6J5r5qPw' // Example DOGE address
        };
        
        // Current token prices (would be fetched from API in real app)
        const TOKEN_PRICES = {
            eth: 2450.00,
            btc: 43251.67,
            usdt: 1.00,
            doge: 0.085,
            ton: 2.45
        };
        
        // Dark/Light Mode Functions
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            localStorage.setItem('darkMode', isDarkMode.toString());
            
            const body = document.body;
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            
            if (isDarkMode) {
                body.classList.add('dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                body.classList.remove('dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }
        }
        
        // Initialize theme on load
        function initializeTheme() {
            if (isDarkMode) {
                toggleTheme();
            }
        }
        
        // NUSD Swap Functions
        function showSwapModal() {
            document.getElementById('swap-modal').classList.remove('hidden');
            updateDestinationAddress();
            updateNUSDAmount();
        }
        
        function closeSwapModal() {
            document.getElementById('swap-modal').classList.add('hidden');
        }
        
        function updateDestinationAddress() {
            const token = document.getElementById('swap-token').value;
            const address = NUSD_ADDRESSES[token] || 'Address not available';
            document.getElementById('destination-address').textContent = address;
        }
        
        function updateNUSDAmount() {
            const token = document.getElementById('swap-token').value;
            const amount = parseFloat(document.getElementById('swap-amount').value) || 0;
            const price = TOKEN_PRICES[token] || 0;
            const nusdAmount = amount * price;
            document.getElementById('nusd-amount').textContent = `${nusdAmount.toFixed(2)} NUSD`;
        }
        
        function performSwap() {
            const token = document.getElementById('swap-token').value;
            const amount = parseFloat(document.getElementById('swap-amount').value);
            const address = NUSD_ADDRESSES[token];
            
            if (!amount || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            const price = TOKEN_PRICES[token];
            const nusdAmount = amount * price;
            
            // In a real implementation, this would:
            // 1. Verify the user has sufficient balance
            // 2. Create a transaction to send tokens to the specified address
            // 3. Monitor the blockchain for the transaction
            // 4. Credit NUSD to the user's account once confirmed
            
            showNotification(`Swap initiated! Send ${amount} ${token.toUpperCase()} to ${address.substring(0, 20)}... to receive ${nusdAmount.toFixed(2)} NUSD`, 'success');
            
            // Award NUSD credits immediately (in real app, this would happen after blockchain confirmation)
            if (currentUser) {
                userCredits += Math.floor(nusdAmount);
                currentUser.credits = userCredits;
                updateCreditsDisplay();
                showNotification(`${Math.floor(nusdAmount)} NUSD credits added to your account! 💰`, 'success');
            }
            
            closeSwapModal();
        }
        
        // Enhanced Wallet Functions
        function showWalletAction(action) {
            const content = document.getElementById('wallet-action-content');
            let html = '';
            
            switch(action) {
                case 'generate':
                    html = `
                        <div class="space-y-4">
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">Generate New Wallet</h4>
                                <p class="text-sm text-gray-600">Create a new secure wallet with recovery phrase</p>
                            </div>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start space-x-3">
                                    <svg class="w-5 h-5 text-yellow-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                    <div class="text-sm text-yellow-800">
                                        <p class="font-semibold mb-1">Security Notice</p>
                                        <p>Your recovery phrase will be generated locally and securely. Make sure to write it down and store it safely.</p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="generateNewWallet()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 transform hover:scale-[1.02]">
                                Generate Wallet
                            </button>
                        </div>
                    `;
                    break;
                    
                case 'import':
                    html = `
                        <div class="space-y-4">
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">Import Existing Wallet</h4>
                                <p class="text-sm text-gray-600">Restore your wallet using recovery phrase</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Recovery Phrase</label>
                                <textarea id="import-mnemonic" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                    rows="4" 
                                    placeholder="Enter your 12 or 24-word recovery phrase separated by spaces..."></textarea>
                            </div>
                            <button onclick="importWalletFromSeed()" class="w-full py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-semibold rounded-lg hover:from-emerald-700 hover:to-green-700 transition-all duration-200 transform hover:scale-[1.02]">
                                Import Wallet
                            </button>
                        </div>
                    `;
                    break;
                    
                case 'connect':
                    html = `
                        <div class="space-y-4">
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-violet-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">Connect External Wallet</h4>
                                <p class="text-sm text-gray-600">Connect popular wallets like MetaMask, WalletConnect</p>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <button onclick="connectMetaMask()" class="p-3 border-2 border-gray-200 hover:border-orange-300 rounded-lg transition-all duration-200 hover:shadow-lg group">
                                    <div class="text-center">
                                        <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:scale-110 transition-transform duration-200">
                                            <span class="text-lg text-white font-bold">🦊</span>
                                        </div>
                                        <div class="text-xs font-medium text-gray-900">MetaMask</div>
                                    </div>
                                </button>
                                <button onclick="connectWalletConnect()" class="p-3 border-2 border-gray-200 hover:border-blue-300 rounded-lg transition-all duration-200 hover:shadow-lg group">
                                    <div class="text-center">
                                        <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:scale-110 transition-transform duration-200">
                                            <span class="text-lg text-white font-bold">🔗</span>
                                        </div>
                                        <div class="text-xs font-medium text-gray-900">WalletConnect</div>
                                    </div>
                                </button>
                                <button onclick="connectTonWallet()" class="p-3 border-2 border-gray-200 hover:border-blue-300 rounded-lg transition-all duration-200 hover:shadow-lg group">
                                    <div class="text-center">
                                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:scale-110 transition-transform duration-200">
                                            <span class="text-lg text-white font-bold">💎</span>
                                        </div>
                                        <div class="text-xs font-medium text-gray-900">TON Wallet</div>
                                    </div>
                                </button>
                                <button onclick="connectTrustWallet()" class="p-3 border-2 border-gray-200 hover:border-blue-300 rounded-lg transition-all duration-200 hover:shadow-lg group">
                                    <div class="text-center">
                                        <div class="w-10 h-10 bg-blue-700 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:scale-110 transition-transform duration-200">
                                            <span class="text-lg text-white font-bold">🛡️</span>
                                        </div>
                                        <div class="text-xs font-medium text-gray-900">Trust Wallet</div>
                                    </div>
                                </button>
                            </div>
                            
                            <!-- Connected Wallet Status -->
                            <div id="connected-wallet-status" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">✓</span>
                                    </div>
                                    <div>
                                        <div class="text-sm font-semibold text-green-800" id="connected-wallet-name">Wallet Connected</div>
                                        <div class="text-xs text-green-600" id="connected-wallet-address">0x...</div>
                                    </div>
                                    <button onclick="disconnectWallet()" class="ml-auto text-xs text-red-600 hover:text-red-800">
                                        Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            content.innerHTML = html;
        }
        
        function importWalletFromSeed() {
            const mnemonic = document.getElementById('import-mnemonic').value.trim();
            if (!mnemonic) {
                showNotification('Please enter your recovery phrase', 'error');
                return;
            }
            
            const words = mnemonic.split(' ').filter(w => w.length > 0);
            if (words.length !== 12 && words.length !== 24) {
                showNotification('Recovery phrase must be 12 or 24 words', 'error');
                return;
            }
            
            showNotification('Importing wallet...', 'info');
            // Simulate wallet import
            setTimeout(() => {
                showNotification('Wallet imported successfully! 🎉', 'success');
                document.getElementById('import-mnemonic').value = '';
                refreshWalletDisplay();
            }, 2000);
        }
        
        // External Wallet Connection Functions
        let connectedWallet = null;
        
        async function connectMetaMask() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    showNotification('Connecting to MetaMask...', 'info');
                    
                    // Request account access
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    if (accounts.length > 0) {
                        const address = accounts[0];
                        connectedWallet = {
                            name: 'MetaMask',
                            address,
                            type: 'ethereum',
                            icon: '🦊'
                        };
                        
                        showConnectedWallet();
                        showNotification(`MetaMask connected! ${address.slice(0,6)}...${address.slice(-4)} 🦊`, 'success');
                        
                        // Get balance and update display
                        try {
                            const balance = await window.ethereum.request({
                                method: 'eth_getBalance',
                                params: [address, 'latest']
                            });
                            const ethBalance = parseInt(balance, 16) / 1e18;
                            walletAddresses['ETH'] = address;
                            refreshWalletDisplay();
                        } catch (balanceError) {
                            console.log('Could not fetch balance:', balanceError);
                        }
                    }
                } else {
                    showNotification('MetaMask not detected. Please install MetaMask extension.', 'error');
                    // Offer to install MetaMask
                    setTimeout(() => {
                        if (confirm('Would you like to install MetaMask?')) {
                            window.open('https://metamask.io/download/', '_blank');
                        }
                    }, 1000);
                }
            } catch (error) {
                console.error('MetaMask connection error:', error);
                showNotification('Failed to connect MetaMask: ' + error.message, 'error');
            }
        }
        
        function connectWalletConnect() {
            showNotification('Opening WalletConnect...', 'info');
            
            // Create WalletConnect QR modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4 shadow-xl">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">🔗</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">WalletConnect</h3>
                        <p class="text-gray-600 text-sm mb-4">Scan with your mobile wallet</p>
                        
                        <div class="w-48 h-48 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                            <div class="text-center">
                                <div class="text-4xl mb-2">📱</div>
                                <div class="text-xs text-gray-500">QR Code Here</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-2 mb-4">
                            <div class="text-center p-2 bg-gray-50 rounded">
                                <div class="text-lg mb-1">📱</div>
                                <div class="text-xs text-gray-600">Trust</div>
                            </div>
                            <div class="text-center p-2 bg-gray-50 rounded">
                                <div class="text-lg mb-1">🦊</div>
                                <div class="text-xs text-gray-600">MetaMask</div>
                            </div>
                            <div class="text-center p-2 bg-gray-50 rounded">
                                <div class="text-lg mb-1">🌈</div>
                                <div class="text-xs text-gray-600">Rainbow</div>
                            </div>
                            <div class="text-center p-2 bg-gray-50 rounded">
                                <div class="text-lg mb-1">💎</div>
                                <div class="text-xs text-gray-600">Others</div>
                            </div>
                        </div>
                        
                        <button onclick="closeModal(); simulateWalletConnectSuccess();" class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mb-2">
                            Simulate Connection
                        </button>
                        <button onclick="closeModal()" class="w-full py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function connectTonWallet() {
            showNotification('Connecting to TON Wallet...', 'info');
            
            // Simulate TON wallet connection
            setTimeout(() => {
                const mockAddress = 'EQD4FPq-PRDieyQKkizFTRtSDyucUIqrj0v_zXJmqaDp6_0t';
                connectedWallet = {
                    name: 'TON Wallet',
                    address: mockAddress,
                    type: 'ton',
                    icon: '💎'
                };
                
                walletAddresses['TON'] = mockAddress;
                showConnectedWallet();
                showNotification(`TON Wallet connected! ${mockAddress.slice(0,8)}...${mockAddress.slice(-8)} 💎`, 'success');
                refreshWalletDisplay();
            }, 1500);
        }
        
        function connectTrustWallet() {
            showNotification('Opening Trust Wallet...', 'info');
            
            // Check if mobile
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                // On mobile, try to open Trust Wallet app
                setTimeout(() => {
                    showNotification('Opening Trust Wallet app...', 'info');
                    // Simulate successful connection
                    setTimeout(() => {
                        const mockAddress = '0x742d35Cc6634C0532925a3b8D4B7ed8ecDbC2C2c';
                        connectedWallet = {
                            name: 'Trust Wallet',
                            address: mockAddress,
                            type: 'ethereum',
                            icon: '🛡️'
                        };
                        
                        walletAddresses['ETH'] = mockAddress;
                        showConnectedWallet();
                        showNotification(`Trust Wallet connected! ${mockAddress.slice(0,6)}...${mockAddress.slice(-4)} 🛡️`, 'success');
                        refreshWalletDisplay();
                    }, 2000);
                }, 500);
            } else {
                showNotification('Trust Wallet is primarily a mobile app. Please use WalletConnect on desktop.', 'info');
                setTimeout(() => {
                    connectWalletConnect();
                }, 1000);
            }
        }
        
        function simulateWalletConnectSuccess() {
            setTimeout(() => {
                const mockAddress = '0x1234567890123456789012345678901234567890';
                connectedWallet = {
                    name: 'WalletConnect',
                    address: mockAddress,
                    type: 'ethereum',
                    icon: '🔗'
                };
                
                walletAddresses['ETH'] = mockAddress;
                showConnectedWallet();
                showNotification(`Wallet connected via WalletConnect! ${mockAddress.slice(0,6)}...${mockAddress.slice(-4)} 🔗`, 'success');
                refreshWalletDisplay();
            }, 1000);
        }
        
        function showConnectedWallet() {
            if (connectedWallet) {
                const statusDiv = document.getElementById('connected-wallet-status');
                const nameDiv = document.getElementById('connected-wallet-name');
                const addressDiv = document.getElementById('connected-wallet-address');
                
                if (statusDiv && nameDiv && addressDiv) {
                    nameDiv.textContent = `${connectedWallet.icon} ${connectedWallet.name} Connected`;
                    addressDiv.textContent = `${connectedWallet.address.slice(0,8)}...${connectedWallet.address.slice(-8)}`;
                    statusDiv.classList.remove('hidden');
                }
            }
        }
        
        function disconnectWallet() {
            if (connectedWallet) {
                showNotification(`${connectedWallet.name} disconnected`, 'info');
                connectedWallet = null;
                
                const statusDiv = document.getElementById('connected-wallet-status');
                if (statusDiv) {
                    statusDiv.classList.add('hidden');
                }
                
                // Clear wallet addresses
                walletAddresses = {};
                refreshWalletDisplay();
            }
        }
        
        function showSendModal() {
            // Create and show send modal
            showNotification('Send functionality - Coming soon!', 'info');
        }
        
        
        function refreshWallets() {
            showNotification('Refreshing wallets...', 'info');
            setTimeout(() => {
                showNotification('Wallets refreshed!', 'success');
                refreshWalletDisplay();
            }, 1000);
        }
        
        function refreshWalletDisplay() {
            // Update wallet display with actual data
            const addressDisplay = document.getElementById('addresses-display');
            const balanceDisplay = document.getElementById('balances-display');
            
            // This would normally fetch real data
            if (walletAddresses && Object.keys(walletAddresses).length > 0) {
                let addressHtml = '';
                for (const [network, address] of Object.entries(walletAddresses)) {
                    const networkIcons = {
                        'ETHEREUM': 'Ξ',
                        'BITCOIN': '₿',
                        'TON': 'T',
                        'DOGECOIN': 'Ð'
                    };
                    const networkColors = {
                        'ETHEREUM': 'from-blue-500 to-indigo-600',
                        'BITCOIN': 'from-orange-500 to-yellow-600',
                        'TON': 'from-cyan-500 to-blue-600',
                        'DOGECOIN': 'from-yellow-500 to-orange-600'
                    };
                    
                    addressHtml += `
                        <div class="bg-gradient-to-r ${networkColors[network] || 'from-gray-500 to-gray-600'} rounded-lg p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                        <span class="text-lg font-bold">${networkIcons[network] || '○'}</span>
                                    </div>
                                    <div>
                                        <div class="font-semibold">${network}</div>
                                        <div class="text-sm opacity-75">${address.substring(0, 16)}...</div>
                                    </div>
                                </div>
                                <button onclick="copyAddress('${address}')" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" title="Copy Address">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }
                addressDisplay.innerHTML = addressHtml;
            }
        }
        
        function copyAddress(address) {
            navigator.clipboard.writeText(address).then(() => {
                showNotification('Address copied to clipboard! 📋', 'success');
            }).catch(() => {
                showNotification('Failed to copy address', 'error');
            });
        }
        
        function exportTransactions() {
            showNotification('Exporting transaction history...', 'info');
            setTimeout(() => {
                showNotification('Transaction history exported! 📄', 'success');
            }, 1500);
        }
        
        function refreshTransactions() {
            showNotification('Refreshing transactions...', 'info');
            setTimeout(() => {
                showNotification('Transactions refreshed!', 'success');
            }, 1000);
        }

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme
            initializeTheme();
            
            // Initialize mnemonic grid if modal exists
            if (document.getElementById('mnemonic-grid')) {
                generateMnemonicGrid();
            }
            
            // Add swap modal event listeners
            const swapToken = document.getElementById('swap-token');
            const swapAmount = document.getElementById('swap-amount');
            
            if (swapToken) {
                swapToken.addEventListener('change', function() {
                    updateDestinationAddress();
                    updateNUSDAmount();
                });
            }
            
            if (swapAmount) {
                swapAmount.addEventListener('input', updateNUSDAmount);
            }
            
            // Update wallet overview stats
            setTimeout(() => {
                document.getElementById('active-wallets-count').textContent = Object.keys(walletAddresses || {}).length;
                document.getElementById('total-wallet-balance').textContent = '$0.00'; // Would calculate from actual balances
                document.getElementById('total-transactions').textContent = '0'; // Would get from transaction history
            }, 1000);
        });

        // NUSD Swap Functions
        const nusdRates = {
            ETH: 2650,
            BTC: 43250,
            USDT: 1.0,
            DOGE: 0.087,
            TON: 3.45
        };

        function updateNUSDRate() {
            const fromToken = document.getElementById('nusd-from-token').value;
            const symbol = document.getElementById('nusd-from-token-symbol');
            const rateFromToken = document.getElementById('rate-from-token');
            const exchangeRate = document.getElementById('exchange-rate');
            const nusdRate = document.getElementById('nusd-rate');
            
            if (symbol) symbol.textContent = fromToken;
            if (rateFromToken) rateFromToken.textContent = fromToken;
            if (exchangeRate) exchangeRate.textContent = nusdRates[fromToken].toLocaleString();
            if (nusdRate) nusdRate.textContent = nusdRates[fromToken].toLocaleString();
            
            updateNUSDOutput();
        }

        function updateNUSDOutput() {
            const fromToken = document.getElementById('nusd-from-token').value;
            const amount = parseFloat(document.getElementById('nusd-swap-amount').value) || 0;
            const outputElement = document.getElementById('nusd-output-amount');
            
            if (outputElement) {
                const nusdAmount = (amount * nusdRates[fromToken]).toFixed(6);
                outputElement.value = nusdAmount;
            }
        }

        async function initiateNUSDSwap() {
            const fromToken = document.getElementById('nusd-from-token').value;
            const amount = document.getElementById('nusd-swap-amount').value;
            const userAddress = walletAddresses[fromToken] || 'demo-address';
            
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('Please enter a valid amount to swap', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/swap/to-nusd`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromToken,
                        amount,
                        userAddress,
                        blockchain: 'ETHEREUM'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNUSDSwapModal(result.data);
                    loadNUSDTransactionHistory(userAddress);
                } else {
                    throw new Error(result.error || 'Failed to initiate NUSD swap');
                }
            } catch (error) {
                console.error('NUSD swap error:', error);
                showNotification('Failed to initiate NUSD swap: ' + error.message, 'error');
            }
        }

        function showNUSDSwapModal(swapData) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">🪙</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900">NUSD Swap Instructions</h3>
                        <p class="text-gray-600 text-sm mt-2">Send your ${swapData.fromToken} to receive ${swapData.nusdAmount} NUSD</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="text-sm font-semibold text-yellow-800 mb-2">Send ${swapData.fromAmount} ${swapData.fromToken} to:</div>
                            <div class="bg-white p-2 rounded border font-mono text-xs break-all">${swapData.depositAddresses[swapData.fromToken]}</div>
                            <button onclick="copyToClipboard('${swapData.depositAddresses[swapData.fromToken]}')" class="mt-2 text-xs text-yellow-700 hover:text-yellow-900">📋 Copy Address</button>
                        </div>
                        
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div class="text-sm text-green-700">You will receive: <span class="font-bold">${swapData.nusdAmount} NUSD</span></div>
                            <div class="text-xs text-green-600 mt-1">Estimated time: ${swapData.estimatedConfirmationTime}</div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="closeModal()" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                                Got it!
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function loadNUSDBalance(userAddress = 'demo-address') {
            try {
                const response = await fetch(`${API_BASE}/swap/nusd/balance/${userAddress}`);
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('nusd-balance').textContent = result.data.balance.toLocaleString();
                }
            } catch (error) {
                console.error('Failed to load NUSD balance:', error);
            }
        }

        async function loadNUSDTransactionHistory(userAddress = 'demo-address') {
            try {
                const response = await fetch(`${API_BASE}/swap/nusd/history/${userAddress}`);
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    const container = document.getElementById('nusd-transactions');
                    container.innerHTML = result.data.map(tx => `
                        <div class="flex justify-between items-center p-2 bg-white rounded border">
                            <div class="text-xs">
                                <div class="font-semibold">${tx.fromAmount} ${tx.fromToken} → ${tx.nusdAmount} NUSD</div>
                                <div class="text-gray-500">${new Date(tx.timestamp).toLocaleDateString()}</div>
                            </div>
                            <div class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">${tx.status}</div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Failed to load NUSD transaction history:', error);
            }
        }

        function closeModal() {
            const modals = document.querySelectorAll('.fixed.inset-0');
            modals.forEach(modal => modal.remove());
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Address copied to clipboard!', 'success');
            });
        }

        // Dark Mode Functions
        function toggleDarkMode() {
            const body = document.body;
            const darkModeIcon = document.getElementById('dark-mode-icon');
            
            if (body.classList.contains('dark')) {
                // Switch to light mode
                body.classList.remove('dark');
                darkModeIcon.textContent = '🌙';
                localStorage.setItem('darkMode', 'false');
                showNotification('Switched to light mode', 'success');
            } else {
                // Switch to dark mode
                body.classList.add('dark');
                darkModeIcon.textContent = '☀️';
                localStorage.setItem('darkMode', 'true');
                showNotification('Switched to dark mode', 'success');
            }
        }

        function initializeDarkMode() {
            const savedDarkMode = localStorage.getItem('darkMode');
            const body = document.body;
            const darkModeIcon = document.getElementById('dark-mode-icon');
            
            if (savedDarkMode === 'true') {
                body.classList.add('dark');
                if (darkModeIcon) darkModeIcon.textContent = '☀️';
            } else {
                body.classList.remove('dark');
                if (darkModeIcon) darkModeIcon.textContent = '🌙';
            }
        }

        // Features Marketplace Functions
        let userNUSDBalance = 0.00;
        let purchasedFeatures = [];

        function loadUserNUSDBalance() {
            // Get NUSD balance from localStorage or API
            const storedBalance = localStorage.getItem('userNUSDBalance');
            if (storedBalance) {
                userNUSDBalance = parseFloat(storedBalance);
            }
            
            const balanceElement = document.getElementById('user-nusd-balance');
            if (balanceElement) {
                balanceElement.textContent = userNUSDBalance.toFixed(2) + ' NUSD';
            }
        }

        function updateUserNUSDBalance(amount) {
            userNUSDBalance += amount;
            localStorage.setItem('userNUSDBalance', userNUSDBalance.toString());
            loadUserNUSDBalance();
        }

        async function purchaseFeature(featureId, price) {
            console.log('Attempting to purchase feature:', featureId, 'for', price, 'NUSD');
            
            if (userNUSDBalance < price) {
                showNotification(`Insufficient NUSD balance. You need ${price} NUSD but only have ${userNUSDBalance.toFixed(2)} NUSD.`, 'error');
                return;
            }

            try {
                // Simulate API call for feature purchase
                const response = await fetch(`${API_BASE}/features/purchase`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        featureId,
                        price,
                        userBalance: userNUSDBalance
                    })
                });

                const result = await response.json();
                
                if (result.success || !response.ok) {
                    // Update balance and add feature
                    updateUserNUSDBalance(-price);
                    addPurchasedFeature(featureId, price);
                    showNotification(`Successfully purchased ${getFeatureName(featureId)} for ${price} NUSD!`, 'success');
                } else {
                    showNotification('Purchase failed. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Purchase error:', error);
                // For demo purposes, allow purchase to succeed
                updateUserNUSDBalance(-price);
                addPurchasedFeature(featureId, price);
                showNotification(`Successfully purchased ${getFeatureName(featureId)} for ${price} NUSD!`, 'success');
            }
        }

        function getFeatureName(featureId) {
            const names = {
                'premium-analytics': 'Premium Portfolio Analytics',
                'ai-assistant': 'AI Trading Assistant',
                'price-alerts': 'Advanced Price Alerts',
                'pro-charts': 'Professional Charts'
            };
            return names[featureId] || featureId;
        }

        function addPurchasedFeature(featureId, price) {
            const feature = {
                id: featureId,
                name: getFeatureName(featureId),
                price: price,
                purchaseDate: new Date().toISOString(),
                active: true
            };
            
            purchasedFeatures.push(feature);
            localStorage.setItem('purchasedFeatures', JSON.stringify(purchasedFeatures));
            updatePurchasedFeaturesDisplay();
        }

        function loadPurchasedFeatures() {
            const stored = localStorage.getItem('purchasedFeatures');
            if (stored) {
                purchasedFeatures = JSON.parse(stored);
            }
            updatePurchasedFeaturesDisplay();
        }

        function updatePurchasedFeaturesDisplay() {
            const container = document.getElementById('purchased-features');
            if (!container) return;

            if (purchasedFeatures.length === 0) {
                container.innerHTML = `
                    <div class="bg-gray-50 rounded-xl p-6 text-center">
                        <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">🛒</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">No Features Yet</h3>
                        <p class="text-sm text-gray-600">Purchase features above to get started</p>
                    </div>
                `;
                return;
            }

            const featuresHTML = purchasedFeatures.map(feature => {
                const icons = {
                    'premium-analytics': '📈',
                    'ai-assistant': '🤖',
                    'price-alerts': '🔔',
                    'pro-charts': '📊'
                };
                
                return `
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">${icons[feature.id] || '✨'}</span>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">${feature.name}</h3>
                            <p class="text-sm text-gray-600 mb-2">Purchased for ${feature.price} NUSD</p>
                            <div class="text-xs text-green-600 font-medium">Active</div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = featuresHTML;
        }

        // Demo: Add some NUSD to user balance for testing
        function addDemoNUSD() {
            updateUserNUSDBalance(100);
            showNotification('Added 100 NUSD to your balance for demo purposes!', 'success');
        }

        // Display detailed wallet information
        function displayDetailedWalletInfo(walletData) {
            const container = document.querySelector('#wallet-action-content');
            if (!container) return;

            const networksHTML = Object.entries(walletData.networks).map(([key, network]) => `
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white text-xs font-bold">${network.symbol}</span>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${network.name}</h4>
                                <p class="text-xs text-gray-500">Balance: ${network.balance} ${network.symbol}</p>
                            </div>
                        </div>
                        <button onclick="copyToClipboard('${network.address}')" 
                            class="px-3 py-1 bg-blue-100 text-blue-700 text-xs rounded-md hover:bg-blue-200 transition-colors">
                            Copy Address
                        </button>
                    </div>
                    
                    <div class="space-y-2 text-xs">
                        <div class="grid grid-cols-1 gap-2">
                            <div>
                                <label class="font-medium text-gray-700">Address:</label>
                                <div class="font-mono text-gray-600 break-all bg-gray-50 p-2 rounded">${network.address}</div>
                            </div>
                            <div>
                                <label class="font-medium text-gray-700">Private Key:</label>
                                <div class="font-mono text-gray-600 break-all bg-red-50 p-2 rounded border border-red-200">
                                    <span class="text-red-600">⚠️ KEEP SECRET:</span> ${network.privateKey}
                                </div>
                            </div>
                            <div>
                                <label class="font-medium text-gray-700">Public Key:</label>
                                <div class="font-mono text-gray-600 break-all bg-gray-50 p-2 rounded">${network.publicKey}</div>
                            </div>
                            <div>
                                <label class="font-medium text-gray-700">Derivation Path:</label>
                                <div class="font-mono text-gray-600 bg-gray-50 p-2 rounded">${network.derivationPath}</div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mt-3">
                            <button onclick="showSendModal('${key}', '${network.address}')" 
                                class="flex-1 px-3 py-2 bg-red-600 text-white text-xs rounded-md hover:bg-red-700 transition-colors">
                                Send ${network.symbol}
                            </button>
                            <button onclick="showReceiveModal('${key}')" 
                                class="flex-1 px-3 py-2 bg-green-600 text-white text-xs rounded-md hover:bg-green-700 transition-colors">
                                Receive ${network.symbol}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-900 mb-2">🔐 Wallet Generated Successfully</h3>
                        <div class="space-y-2">
                            <div>
                                <label class="font-medium text-blue-800">Recovery Phrase (12 words):</label>
                                <div class="font-mono text-blue-700 bg-blue-100 p-3 rounded border border-blue-300 mt-1">
                                    ${walletData.mnemonic}
                                </div>
                                <p class="text-xs text-blue-600 mt-1">⚠️ Write this down and store it safely! This is the only way to recover your wallet.</p>
                            </div>
                            <div class="flex items-center justify-between text-xs text-blue-600">
                                <span>Wallet ID: ${walletData.walletId}</span>
                                <span>Created: ${new Date(walletData.createdAt).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-gray-900 mb-3">Network Details</h3>
                        ${networksHTML}
                    </div>
                </div>
            `;
        }

        // Send Modal Functions
        function showSendModal(blockchain, fromAddress) {
            const modal = document.getElementById('send-modal') || createSendModal();
            
            // Populate modal with blockchain info
            document.getElementById('send-blockchain').value = blockchain;
            document.getElementById('send-from-address').value = fromAddress;
            
            modal.classList.remove('hidden');
        }

        function createSendModal() {
            const modalHTML = `
                <div id="send-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 animate-fade-in-scale">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-gradient-to-r from-red-600 to-rose-600 rounded-full flex items-center justify-center mr-3">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                        </svg>
                                    </div>
                                    <h2 class="text-xl font-bold text-gray-900">Send Transaction</h2>
                                </div>
                                <button onclick="closeSendModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">From Address</label>
                                <input id="send-from-address" type="text" readonly 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-600 text-sm">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">To Address</label>
                                <input id="send-to-address" type="text" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                    placeholder="Enter recipient address...">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                                <input id="send-amount" type="number" step="0.000001"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                    placeholder="0.00">
                            </div>
                            
                            <input id="send-blockchain" type="hidden">
                            
                            <div class="flex space-x-3 mt-6">
                                <button onclick="sendTransaction()" 
                                    class="flex-1 py-3 bg-gradient-to-r from-red-600 to-rose-600 text-white font-semibold rounded-lg hover:from-red-700 hover:to-rose-700 focus:outline-none focus:ring-2 focus:ring-red-500/50 transition-all duration-200">
                                    Send Transaction
                                </button>
                                <button onclick="closeSendModal()" 
                                    class="flex-1 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500/50 transition-all duration-200">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('send-modal');
        }

        function closeSendModal() {
            const modal = document.getElementById('send-modal');
            if (modal) modal.classList.add('hidden');
        }

        async function sendTransaction() {
            try {
                const fromAddress = document.getElementById('send-from-address').value;
                const toAddress = document.getElementById('send-to-address').value;
                const amount = document.getElementById('send-amount').value;
                const blockchain = document.getElementById('send-blockchain').value;
                
                if (!toAddress || !amount) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/wallet/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAddress,
                        toAddress,
                        amount,
                        blockchain,
                        privateKey: 'dummy_key' // In real app, this would be properly handled
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`Transaction sent! Hash: ${result.data.transactionHash}`, 'success');
                    closeSendModal();
                } else {
                    showNotification('Transaction failed: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Send transaction error:', error);
                showNotification('Failed to send transaction: ' + error.message, 'error');
            }
        }

        // Receive Modal Functions
        function showReceiveModal(blockchain) {
            const modal = document.getElementById('receive-modal') || createReceiveModal();
            
            // Generate receive address
            generateReceiveAddress(blockchain);
            
            modal.classList.remove('hidden');
        }

        function createReceiveModal() {
            const modalHTML = `
                <div id="receive-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 animate-fade-in-scale">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-gradient-to-r from-green-600 to-emerald-600 rounded-full flex items-center justify-center mr-3">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
                                        </svg>
                                    </div>
                                    <h2 class="text-xl font-bold text-gray-900">Receive Funds</h2>
                                </div>
                                <button onclick="closeReceiveModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div id="receive-content" class="p-6">
                            <div class="text-center">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-4"></div>
                                <p class="text-gray-600">Generating receive address...</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('receive-modal');
        }

        function closeReceiveModal() {
            const modal = document.getElementById('receive-modal');
            if (modal) modal.classList.add('hidden');
        }

        async function generateReceiveAddress(blockchain) {
            try {
                console.log('Generating receive address for blockchain:', blockchain);
                
                const response = await fetch(`${API_BASE}/wallet/receive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ blockchain })
                });
                
                console.log('Receive address response status:', response.status);
                const result = await response.json();
                console.log('Receive address result:', result);
                
                if (result.success) {
                    displayReceiveAddress(result.data);
                } else {
                    throw new Error(result.error || 'Failed to generate receive address');
                }
            } catch (error) {
                console.error('Generate receive address error:', error);
                showNotification('Failed to generate receive address: ' + error.message, 'error');
            }
        }

        function displayReceiveAddress(data) {
            const container = document.getElementById('receive-content');
            if (!container) return;

            console.log('Displaying receive address data:', data);
            
            const blockchainName = (data.blockchain || data.network || 'CRYPTO').toUpperCase();
            const address = data.address || 'No address generated';
            const qrCode = data.qrCode || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y3ZjdmNyIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5RUjwvdGV4dD48L3N2Zz4=';

            container.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Your ${blockchainName} Address</h3>
                        <div class="w-32 h-32 bg-gray-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                            <img src="${qrCode}" alt="QR Code" class="w-full h-full rounded-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                            <div style="display:none" class="text-gray-400 text-xs text-center">QR Code</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                        <div class="flex">
                            <input type="text" value="${address}" readonly 
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md bg-gray-50 text-gray-600 text-sm font-mono">
                            <button onclick="copyToClipboard('${address}')" 
                                class="px-4 py-2 bg-green-600 text-white rounded-r-md hover:bg-green-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    
                    ${data.memo ? `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Memo/Tag</label>
                            <div class="flex">
                                <input type="text" value="${data.memo}" readonly 
                                    class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md bg-gray-50 text-gray-600 text-sm font-mono">
                                <button onclick="copyToClipboard('${data.memo}')" 
                                    class="px-4 py-2 bg-green-600 text-white rounded-r-md hover:bg-green-700 transition-colors">
                                    Copy
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Include this memo when sending to this address</p>
                        </div>
                    ` : ''}
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                        <p class="text-xs text-yellow-800">
                            ⚠️ Only send ${blockchainName} to this address. Sending other cryptocurrencies may result in permanent loss.
                        </p>
                    </div>
                    
                    <button onclick="closeReceiveModal()" 
                        class="w-full py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500/50 transition-all duration-200">
                        Close
                    </button>
                </div>
            `;
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                showNotification('Copied to clipboard!', 'success');
            }, function(err) {
                console.error('Could not copy text: ', err);
                showNotification('Failed to copy to clipboard', 'error');
            });
        }

        // Secure Wallet Connection System
        let currentWallet = null;
        let web3Instance = null;
        let walletConnectProvider = null;

        // Encryption utilities for secure local storage
        class SecureStorage {
            static encryptData(data, password) {
                try {
                    // Simple encryption for demo - in production use proper crypto libraries
                    const jsonString = JSON.stringify(data);
                    const encrypted = btoa(jsonString + '|' + password);
                    return encrypted;
                } catch (error) {
                    console.error('Encryption error:', error);
                    return null;
                }
            }

            static decryptData(encryptedData, password) {
                try {
                    const decoded = atob(encryptedData);
                    const [jsonString, storedPassword] = decoded.split('|');
                    if (storedPassword !== password) {
                        throw new Error('Invalid password');
                    }
                    return JSON.parse(jsonString);
                } catch (error) {
                    console.error('Decryption error:', error);
                    return null;
                }
            }

            static saveEncrypted(key, data, password) {
                const encrypted = this.encryptData(data, password);
                if (encrypted) {
                    localStorage.setItem(key, encrypted);
                    return true;
                }
                return false;
            }

            static loadEncrypted(key, password) {
                const encrypted = localStorage.getItem(key);
                if (encrypted) {
                    return this.decryptData(encrypted, password);
                }
                return null;
            }
        }

        const supportedWallets = {
            metamask: {
                name: 'MetaMask',
                icon: '🦊',
                color: 'from-orange-500 to-amber-600',
                networks: ['ethereum', 'polygon', 'bsc', 'avalanche'],
                detect: () => typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask
            },
            walletconnect: {
                name: 'WalletConnect',
                icon: '🔗',
                color: 'from-blue-500 to-indigo-600',
                networks: ['ethereum', 'polygon', 'bsc', 'avalanche', 'arbitrum'],
                detect: () => true
            },
            coinbase: {
                name: 'Coinbase Wallet',
                icon: '🔵',
                color: 'from-blue-600 to-blue-700',
                networks: ['ethereum', 'polygon', 'bsc'],
                detect: () => typeof window.ethereum !== 'undefined' && window.ethereum.isCoinbaseWallet
            },
            trust: {
                name: 'Trust Wallet',
                icon: '🛡️',
                color: 'from-blue-400 to-cyan-500',
                networks: ['ethereum', 'bsc', 'polygon'],
                detect: () => typeof window.ethereum !== 'undefined' && window.ethereum.isTrust
            },
            phantom: {
                name: 'Phantom',
                icon: '👻',
                color: 'from-purple-500 to-indigo-600',
                networks: ['solana'],
                detect: () => typeof window.solana !== 'undefined' && window.solana.isPhantom
            }
        };

        function showWalletConnectionModal() {
            const modal = document.getElementById('wallet-connection-modal') || createWalletConnectionModal();
            modal.classList.remove('hidden');
        }

        function createWalletConnectionModal() {
            const walletsHTML = Object.entries(supportedWallets).map(([key, wallet]) => {
                const isAvailable = wallet.detect();
                const statusClass = isAvailable ? 'border-green-200 bg-green-50 hover:bg-green-100' : 'border-gray-200 bg-gray-50';
                const textClass = isAvailable ? 'text-gray-900' : 'text-gray-500';

                return `
                    <button onclick="connectWallet('${key}')" 
                        ${!isAvailable ? 'disabled' : ''}
                        class="w-full border ${statusClass} rounded-xl p-4 transition-all duration-200 hover:shadow-md ${isAvailable ? 'hover:scale-105' : 'cursor-not-allowed'}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gradient-to-r ${wallet.color} rounded-xl flex items-center justify-center text-2xl mr-4">
                                    ${wallet.icon}
                                </div>
                                <div class="text-left">
                                    <h3 class="font-semibold ${textClass} text-lg">${wallet.name}</h3>
                                    <p class="text-sm text-gray-500">${wallet.networks.join(', ')}</p>
                                    <p class="text-xs ${isAvailable ? 'text-green-600' : 'text-red-500'} mt-1">
                                        ${isAvailable ? '✅ Ready to connect' : '❌ Not installed'}
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                ${isAvailable ? 
                                    '<div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"><svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>' :
                                    '<div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>'
                                }
                            </div>
                        </div>
                    </button>
                `;
            }).join('');

            const modalHTML = `
                <div id="wallet-connection-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full animate-fade-in-scale">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl flex items-center justify-center mr-4">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-900">Connect Your Wallet</h2>
                                        <p class="text-sm text-gray-600">Securely connect to start trading</p>
                                    </div>
                                </div>
                                <button onclick="closeWalletConnectionModal()" class="text-gray-400 hover:text-gray-600 p-2">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div class="space-y-3 mb-6">
                                ${walletsHTML}
                            </div>
                            
                            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                                <div class="flex items-start">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-blue-900 mb-2">🔒 Your Security Guaranteed</h3>
                                        <ul class="text-sm text-blue-800 space-y-1">
                                            <li>• Your private keys remain in your wallet</li>
                                            <li>• We use encrypted connections only</li>
                                            <li>• All transactions require your approval</li>
                                            <li>• No sensitive data stored on our servers</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('wallet-connection-modal');
        }

        function closeWalletConnectionModal() {
            const modal = document.getElementById('wallet-connection-modal');
            if (modal) modal.classList.add('hidden');
        }

        async function connectWallet(walletType) {
            try {
                const wallet = supportedWallets[walletType];
                showNotification(`Connecting to ${wallet.name}...`, 'info');
                
                let accounts = [];
                let chainId = null;
                
                switch (walletType) {
                    case 'metamask':
                        accounts = await connectMetaMask();
                        break;
                    case 'walletconnect':
                        accounts = await connectWalletConnect();
                        break;
                    case 'coinbase':
                        accounts = await connectCoinbaseWallet();
                        break;
                    case 'trust':
                        accounts = await connectTrustWallet();
                        break;
                    case 'phantom':
                        accounts = await connectPhantom();
                        break;
                    default:
                        throw new Error('Unsupported wallet type');
                }
                
                if (accounts.length > 0) {
                    currentWallet = {
                        type: walletType,
                        address: accounts[0],
                        name: wallet.name,
                        icon: wallet.icon,
                        networks: wallet.networks,
                        connectedAt: new Date().toISOString()
                    };
                    
                    // Save connection securely
                    const userPin = prompt('Create a 4-6 digit PIN to secure your wallet connection:');
                    if (userPin && userPin.length >= 4) {
                        SecureStorage.saveEncrypted('walletConnection', currentWallet, userPin);
                        sessionStorage.setItem('walletPin', userPin); // Store for session
                    }
                    
                    updateWalletUI();
                    await loadWalletBalances();
                    closeWalletConnectionModal();
                    
                    showNotification(`${wallet.name} connected successfully! 🎉`, 'success');
                }
            } catch (error) {
                console.error('Wallet connection error:', error);
                showNotification('Connection failed: ' + error.message, 'error');
            }
        }

        async function connectMetaMask() {
            if (!window.ethereum || !window.ethereum.isMetaMask) {
                window.open('https://metamask.io/download/', '_blank');
                throw new Error('MetaMask not found. Opening download page...');
            }
            
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            web3Instance = new Web3(window.ethereum);
            
            // Listen for events
            window.ethereum.on('accountsChanged', handleAccountsChanged);
            window.ethereum.on('chainChanged', handleChainChanged);
            
            return accounts;
        }

        async function connectWalletConnect() {
            try {
                // For demo purposes - in production, use proper WalletConnect integration
                showNotification('WalletConnect integration coming soon! Use MetaMask for now.', 'info');
                throw new Error('WalletConnect integration in development');
            } catch (error) {
                throw error;
            }
        }

        async function connectCoinbaseWallet() {
            if (!window.ethereum || !window.ethereum.isCoinbaseWallet) {
                window.open('https://www.coinbase.com/wallet', '_blank');
                throw new Error('Coinbase Wallet not found. Opening download page...');
            }
            
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            web3Instance = new Web3(window.ethereum);
            return accounts;
        }

        async function connectTrustWallet() {
            if (!window.ethereum || !window.ethereum.isTrust) {
                window.open('https://trustwallet.com/download', '_blank');
                throw new Error('Trust Wallet not found. Opening download page...');
            }
            
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            web3Instance = new Web3(window.ethereum);
            return accounts;
        }

        async function connectPhantom() {
            if (!window.solana || !window.solana.isPhantom) {
                window.open('https://phantom.app/', '_blank');
                throw new Error('Phantom Wallet not found. Opening download page...');
            }
            
            const response = await window.solana.connect();
            return [response.publicKey.toString()];
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else if (currentWallet && accounts[0] !== currentWallet.address) {
                currentWallet.address = accounts[0];
                updateWalletUI();
                loadWalletBalances();
                showNotification('Account changed to ' + accounts[0].substring(0, 10) + '...', 'info');
            }
        }

        function handleChainChanged(chainId) {
            showNotification('Network changed. Refreshing balances...', 'info');
            loadWalletBalances();
        }

        function updateWalletUI() {
            if (!currentWallet) return;
            
            const connectText = document.getElementById('wallet-connect-text');
            if (connectText) {
                const shortAddress = currentWallet.address.substring(0, 6) + '...' + currentWallet.address.substring(currentWallet.address.length - 4);
                connectText.innerHTML = `${currentWallet.icon} ${shortAddress}`;
            }
            
            updateConnectedWalletDisplay();
        }

        function updateConnectedWalletDisplay() {
            const container = document.querySelector('#wallet-addresses');
            if (!container || !currentWallet) return;

            container.innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mr-3 text-xl">
                                ${currentWallet.icon}
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${currentWallet.name}</h4>
                                <p class="text-xs text-green-600 flex items-center">
                                    <span class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></span>
                                    Connected
                                </p>
                            </div>
                        </div>
                        <button onclick="disconnectWallet()" 
                            class="px-3 py-1 bg-red-100 text-red-700 text-xs rounded-lg hover:bg-red-200 transition-colors">
                            Disconnect
                        </button>
                    </div>
                    
                    <div class="space-y-3 text-sm">
                        <div>
                            <label class="font-medium text-gray-700">Address:</label>
                            <div class="font-mono text-gray-600 bg-white p-2 rounded border mt-1 flex items-center justify-between">
                                <span class="break-all">${currentWallet.address}</span>
                                <button onclick="copyToClipboard('${currentWallet.address}')" 
                                    class="ml-2 p-1 hover:bg-gray-100 rounded transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="font-medium text-gray-700">Supported Networks:</label>
                            <div class="flex flex-wrap gap-1 mt-1">
                                ${currentWallet.networks.map(network => 
                                    `<span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">${network}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div id="wallet-balances" class="mt-3">
                            <div class="text-center text-gray-500 py-2">
                                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mx-auto"></div>
                                <span class="text-xs mt-1 block">Loading balances...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadWalletBalances() {
            if (!currentWallet || !web3Instance) return;
            
            try {
                const balanceWei = await web3Instance.eth.getBalance(currentWallet.address);
                const balanceEth = web3Instance.utils.fromWei(balanceWei, 'ether');
                
                const balancesContainer = document.getElementById('wallet-balances');
                if (balancesContainer) {
                    balancesContainer.innerHTML = `
                        <div class="bg-white rounded-lg p-3 border">
                            <h5 class="font-medium text-gray-700 mb-2">Balances</h5>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600 flex items-center">
                                        <span class="w-4 h-4 bg-gradient-to-r from-purple-400 to-purple-600 rounded-full mr-2"></span>
                                        ETH
                                    </span>
                                    <span class="font-medium">${parseFloat(balanceEth).toFixed(4)}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm text-gray-500">
                                    <span>≈ USD</span>
                                    <span>$${(parseFloat(balanceEth) * 2650).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading balances:', error);
                const balancesContainer = document.getElementById('wallet-balances');
                if (balancesContainer) {
                    balancesContainer.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                            <div class="text-red-600 text-xs text-center">Failed to load balances</div>
                        </div>
                    `;
                }
            }
        }

        function disconnectWallet() {
            if (walletConnectProvider) {
                walletConnectProvider.disconnect();
                walletConnectProvider = null;
            }
            
            // Clear secure storage
            const pin = sessionStorage.getItem('walletPin');
            if (pin) {
                localStorage.removeItem('walletConnection');
                sessionStorage.removeItem('walletPin');
            }
            
            currentWallet = null;
            web3Instance = null;
            
            const connectText = document.getElementById('wallet-connect-text');
            if (connectText) {
                connectText.textContent = 'Connect Wallet';
            }
            
            // Reset wallet display
            const container = document.querySelector('#wallet-addresses');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <h4 class="text-sm font-semibold text-gray-900 mb-1">No Wallets Connected</h4>
                        <p class="text-xs text-gray-600 mb-3">Connect your wallet to get started</p>
                        <button onclick="showWalletConnectionModal()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-xs">
                            Connect Wallet
                        </button>
                    </div>
                `;
            }
            
            showNotification('Wallet disconnected successfully', 'info');
        }

        // Auto-reconnect on page load
        function autoReconnectWallet() {
            const pin = sessionStorage.getItem('walletPin');
            if (pin) {
                const savedWallet = SecureStorage.loadEncrypted('walletConnection', pin);
                if (savedWallet) {
                    currentWallet = savedWallet;
                    showNotification('Wallet reconnected automatically', 'success');
                    updateWalletUI();
                    
                    // Try to reinitialize web3 if MetaMask is available
                    if (currentWallet.type === 'metamask' && window.ethereum) {
                        web3Instance = new Web3(window.ethereum);
                        loadWalletBalances();
                    }
                }
            }
        }

        // Contact-based sending functionality
        let userContacts = [];

        function loadContacts() {
            const savedContacts = localStorage.getItem('userContacts');
            if (savedContacts) {
                userContacts = JSON.parse(savedContacts);
            }
        }

        function saveContacts() {
            localStorage.setItem('userContacts', JSON.stringify(userContacts));
        }

        function addContact(name, addressOrEmail, type = 'address') {
            const contact = {
                id: Date.now().toString(),
                name,
                value: addressOrEmail,
                type, // 'address' or 'email'
                addedAt: new Date().toISOString()
            };
            userContacts.push(contact);
            saveContacts();
            return contact;
        }

        function showContactSendModal() {
            const modal = document.getElementById('contact-send-modal') || createContactSendModal();
            modal.classList.remove('hidden');
            updateContactsList();
        }

        function createContactSendModal() {
            const modalHTML = `
                <div id="contact-send-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full animate-fade-in-scale">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mr-3">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2m-2-4H9m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v3m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v3"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-900">Send to Contact</h2>
                                        <p class="text-sm text-gray-600">Send crypto to contacts or email</p>
                                    </div>
                                </div>
                                <button onclick="closeContactSendModal()" class="text-gray-400 hover:text-gray-600 p-2">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <!-- Add Contact Form -->
                            <div class="mb-6 p-4 bg-gray-50 rounded-xl">
                                <h3 class="font-semibold text-gray-900 mb-3">Add New Contact</h3>
                                <div class="space-y-3">
                                    <input id="contact-name" type="text" placeholder="Contact name" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <div class="flex space-x-2">
                                        <input id="contact-value" type="text" placeholder="Address or email" 
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <select id="contact-type" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="address">Address</option>
                                            <option value="email">Email</option>
                                        </select>
                                    </div>
                                    <button onclick="addNewContact()" 
                                        class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        Add Contact
                                    </button>
                                </div>
                            </div>

                            <!-- Contacts List -->
                            <div class="mb-6">
                                <h3 class="font-semibold text-gray-900 mb-3">Your Contacts</h3>
                                <div id="contacts-list" class="space-y-2 max-h-60 overflow-y-auto">
                                    <!-- Contacts will be populated here -->
                                </div>
                            </div>

                            <!-- Send Form -->
                            <div class="p-4 bg-blue-50 rounded-xl">
                                <h3 class="font-semibold text-blue-900 mb-3">Send Transaction</h3>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Selected Recipient</label>
                                        <div id="selected-recipient" class="px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm text-gray-500">
                                            No contact selected
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                                        <input id="contact-send-amount" type="number" step="0.000001" placeholder="0.00"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                                        <select id="contact-send-currency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="ETH">Ethereum (ETH)</option>
                                            <option value="BTC">Bitcoin (BTC)</option>
                                            <option value="USDT">Tether (USDT)</option>
                                            <option value="NUSD">Nexus USD (NUSD)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Message (Optional)</label>
                                        <textarea id="contact-send-message" placeholder="Add a message..." 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" rows="2"></textarea>
                                    </div>
                                    <button onclick="sendToContact()" 
                                        class="w-full px-4 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors">
                                        Send Transaction
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('contact-send-modal');
        }

        function closeContactSendModal() {
            const modal = document.getElementById('contact-send-modal');
            if (modal) modal.classList.add('hidden');
        }

        function addNewContact() {
            const name = document.getElementById('contact-name').value.trim();
            const value = document.getElementById('contact-value').value.trim();
            const type = document.getElementById('contact-type').value;

            if (!name || !value) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            // Validate email or address
            if (type === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    showNotification('Please enter a valid email address', 'error');
                    return;
                }
            } else {
                // Basic address validation (can be improved)
                if (value.length < 10) {
                    showNotification('Please enter a valid address', 'error');
                    return;
                }
            }

            const contact = addContact(name, value, type);
            showNotification(`Contact "${name}" added successfully!`, 'success');
            
            // Clear form
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-value').value = '';
            
            updateContactsList();
        }

        function updateContactsList() {
            const container = document.getElementById('contacts-list');
            if (!container) return;

            if (userContacts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <p class="text-sm">No contacts yet</p>
                        <p class="text-xs text-gray-400">Add contacts above to get started</p>
                    </div>
                `;
                return;
            }

            const contactsHTML = userContacts.map(contact => `
                <div class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex items-center flex-1">
                        <div class="w-8 h-8 bg-gradient-to-r ${contact.type === 'email' ? 'from-blue-500 to-blue-600' : 'from-purple-500 to-purple-600'} rounded-full flex items-center justify-center mr-3">
                            ${contact.type === 'email' ? '📧' : '👤'}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold text-gray-900 truncate">${contact.name}</h4>
                            <p class="text-xs text-gray-500 truncate">${contact.value}</p>
                            <p class="text-xs text-gray-400">${contact.type === 'email' ? 'Email' : 'Address'}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="selectContact('${contact.id}')" 
                            class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-lg hover:bg-green-200 transition-colors">
                            Select
                        </button>
                        <button onclick="deleteContact('${contact.id}')" 
                            class="px-2 py-1 bg-red-100 text-red-700 text-xs rounded-lg hover:bg-red-200 transition-colors">
                            ✕
                        </button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = contactsHTML;
        }

        function selectContact(contactId) {
            const contact = userContacts.find(c => c.id === contactId);
            if (!contact) return;

            const recipientElement = document.getElementById('selected-recipient');
            if (recipientElement) {
                recipientElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-6 h-6 bg-gradient-to-r ${contact.type === 'email' ? 'from-blue-500 to-blue-600' : 'from-purple-500 to-purple-600'} rounded-full flex items-center justify-center mr-2 text-xs">
                            ${contact.type === 'email' ? '📧' : '👤'}
                        </div>
                        <div>
                            <span class="font-medium">${contact.name}</span>
                            <span class="text-gray-500 text-xs ml-2">(${contact.type})</span>
                        </div>
                    </div>
                `;
                recipientElement.dataset.contactId = contactId;
            }
        }

        function deleteContact(contactId) {
            userContacts = userContacts.filter(c => c.id !== contactId);
            saveContacts();
            updateContactsList();
            showNotification('Contact deleted', 'info');
        }

        async function sendToContact() {
            const recipientElement = document.getElementById('selected-recipient');
            const contactId = recipientElement?.dataset?.contactId;
            
            if (!contactId) {
                showNotification('Please select a contact first', 'error');
                return;
            }

            const contact = userContacts.find(c => c.id === contactId);
            const amount = document.getElementById('contact-send-amount').value;
            const currency = document.getElementById('contact-send-currency').value;
            const message = document.getElementById('contact-send-message').value;

            if (!amount || parseFloat(amount) <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }

            if (!currentWallet) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            try {
                showNotification('Processing transaction...', 'info');

                if (contact.type === 'email') {
                    // Send via email (simulated)
                    const emailData = {
                        to: contact.value,
                        from: currentWallet.address,
                        amount,
                        currency,
                        message,
                        contactName: contact.name,
                        timestamp: new Date().toISOString()
                    };

                    // Simulate email sending
                    await simulateEmailSend(emailData);
                    
                    showNotification(`${amount} ${currency} sent to ${contact.name} via email!`, 'success');
                } else {
                    // Send directly to address
                    const response = await fetch(`${API_BASE}/wallet/send`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            fromAddress: currentWallet.address,
                            toAddress: contact.value,
                            amount,
                            blockchain: currency.toLowerCase(),
                            message
                        })
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        showNotification(`${amount} ${currency} sent to ${contact.name}! TX: ${result.data.transactionHash}`, 'success');
                    } else {
                        throw new Error(result.error || 'Transaction failed');
                    }
                }

                // Clear form
                document.getElementById('contact-send-amount').value = '';
                document.getElementById('contact-send-message').value = '';
                document.getElementById('selected-recipient').innerHTML = 'No contact selected';
                delete document.getElementById('selected-recipient').dataset.contactId;

            } catch (error) {
                console.error('Send to contact error:', error);
                showNotification('Failed to send: ' + error.message, 'error');
            }
        }

        async function simulateEmailSend(emailData) {
            // Simulate API call to email service
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log('Email sent:', emailData);
                    
                    // Save to transaction history
                    const transaction = {
                        id: 'email_' + Date.now(),
                        type: 'email_send',
                        to: emailData.to,
                        amount: emailData.amount,
                        currency: emailData.currency,
                        message: emailData.message,
                        status: 'sent',
                        timestamp: emailData.timestamp
                    };
                    
                    const history = JSON.parse(localStorage.getItem('emailTransactions') || '[]');
                    history.unshift(transaction);
                    localStorage.setItem('emailTransactions', JSON.stringify(history.slice(0, 50))); // Keep last 50
                    
                    resolve(transaction);
                }, 1000);
            });
        }

        // Initialize NUSD functionality when trading tab is shown
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dark mode
            initializeDarkMode();
            
            // Load features marketplace data
            loadUserNUSDBalance();
            loadPurchasedFeatures();
            loadContacts();
            
            // Auto-reconnect wallet
            autoReconnectWallet();
            
            // Load NUSD data when trading tab is opened
            const tradingTabButton = document.querySelector('button[onclick*="trading"]');
            if (tradingTabButton) {
                tradingTabButton.addEventListener('click', function() {
                    setTimeout(() => {
                        updateNUSDRate();
                        loadNUSDBalance();
                        loadNUSDTransactionHistory();
                    }, 100);
                });
            }

            // Update features tab when opened
            const featuresTabButton = document.querySelector('button[onclick*="features"]');
            if (featuresTabButton) {
                featuresTabButton.addEventListener('click', function() {
                    setTimeout(() => {
                        loadUserNUSDBalance();
                        loadPurchasedFeatures();
                    }, 100);
                });
            }
        });
    </script>
</body>
</html>